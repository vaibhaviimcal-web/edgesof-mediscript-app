<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdgesOf MediScript - Phase 7 Week 2 Complete</title>
  <link rel="icon" href="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    body { background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%); }
    .btn { padding: 12px 28px; border-radius: 12px; font-weight: 600; transition: all 0.3s; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; border: none; }
    .btn-sm { padding: 8px 16px; font-size: 14px; }
    .btn-primary { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4); }
    .btn-secondary { background: white; color: #1f2937; border: 2px solid #e5e7eb; }
    .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
    .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
    .btn-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
    .btn-info { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; }
    .btn-purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; }
    .card { background: white; border-radius: 20px; padding: 32px; box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 10px 40px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.04); transition: all 0.3s; }
    .card:hover { transform: translateY(-4px); box-shadow: 0 4px 6px rgba(0,0,0,0.05), 0 20px 60px rgba(0,0,0,0.08); }
    .form-input { width: 100%; padding: 14px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; }
    .form-input:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
    .form-label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px; }
    .badge { display: inline-flex; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    .badge-primary { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; }
    .badge-success { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
    .badge-warning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
    .badge-danger { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b; }
    .badge-purple { background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); color: #6b21a8; }
    .nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 20px; border-radius: 12px; color: rgba(255,255,255,0.8); transition: all 0.2s; text-decoration: none; cursor: pointer; }
    .nav-link:hover { background: rgba(255,255,255,0.1); color: white; }
    .nav-link.active { background: rgba(255,255,255,0.15); color: white; font-weight: 600; }
    .toast { position: fixed; bottom: 32px; right: 32px; background: white; border-radius: 16px; padding: 20px 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 16px; z-index: 9999; animation: slideIn 0.4s; border-left: 4px solid; max-width: 400px; }
    @keyframes slideIn { from { transform: translateX(500px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .toast-success { border-left-color: #10b981; }
    .toast-error { border-left-color: #ef4444; }
    .toast-info { border-left-color: #3b82f6; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); z-index: 9998; display: flex; align-items: center; justify-content: center; padding: 24px; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal-content { background: white; border-radius: 24px; max-width: 1200px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 80px rgba(0,0,0,0.25); animation: scaleIn 0.4s; }
    @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .template-card { cursor: pointer; transition: all 0.3s; border: 2px solid #e5e7eb; }
    .template-card:hover { border-color: #2563eb; background: #eff6ff; transform: translateY(-2px); }
    .template-card.selected { border-color: #2563eb; background: #dbeafe; }
    .voice-btn { position: relative; }
    .voice-btn.recording { animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .result-input { border-left: 4px solid #3b82f6; }
    .result-input.abnormal { border-left-color: #ef4444; background: #fef2f2; }
    .result-input.normal { border-left-color: #10b981; background: #f0fdf4; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // Database with expanded ICD-10 codes
    window.DB = {
      clinics: [{id: 'clinic-1', name: 'City Health Clinic', logo_url: 'https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg', gstin: '27AABCU9603R1ZM', state_code: '27', place_of_business: 'Maharashtra', address: '123 Medical Street, Mumbai', phone: '+91 22 1234 5678', email: 'info@cityhealthclinic.com', website: 'www.cityhealthclinic.com', primary_color: '#2563eb', secondary_color: '#10b981'}],
      patients: [
        {id: 'p1', patient_id: 'P001', first_name: 'Rajesh', last_name: 'Kumar', age: 45, gender: 'Male', blood_group: 'O+', phone: '+919876543220', email: 'rajesh@example.com'},
        {id: 'p2', patient_id: 'P002', first_name: 'Priya', last_name: 'Sharma', age: 32, gender: 'Female', blood_group: 'A+', phone: '+919876543221', email: 'priya@example.com'},
        {id: 'p3', patient_id: 'P003', first_name: 'Amit', last_name: 'Patel', age: 28, gender: 'Male', blood_group: 'B+', phone: '+919876543222', email: 'amit@example.com'}
      ],
      medicines: [
        {id: 'm1', name: 'Paracetamol', generic_name: 'Paracetamol', brand_name: 'Crocin', strength: '500', unit: 'mg', form: 'Tablet', category: 'Analgesic', schedule: 'OTC', price: 5, mrp: 6, hsn_code: '30049099'},
        {id: 'm2', name: 'Amoxicillin', generic_name: 'Amoxicillin', brand_name: 'Novamox', strength: '500', unit: 'mg', form: 'Capsule', category: 'Antibiotic', schedule: 'H', price: 15, mrp: 18, hsn_code: '30042090'}
      ],
      prescriptions: [],
      invoices: [],
      opd_queue: [],
      vital_signs: [],
      soap_notes: [],
      lab_orders: [],
      lab_results: [],
      
      // EXPANDED ICD-10 CODES (100+ codes)
      icd10_codes: [
        // Infectious Diseases
        {code: 'A00-B99', description: 'Certain infectious and parasitic diseases', category: 'Infectious'},
        {code: 'A00', description: 'Cholera', category: 'Infectious'},
        {code: 'A01', description: 'Typhoid and paratyphoid fevers', category: 'Infectious'},
        {code: 'A02', description: 'Other salmonella infections', category: 'Infectious'},
        {code: 'A03', description: 'Shigellosis', category: 'Infectious'},
        {code: 'A04', description: 'Other bacterial intestinal infections', category: 'Infectious'},
        {code: 'A05', description: 'Other bacterial foodborne intoxications', category: 'Infectious'},
        {code: 'A06', description: 'Amoebiasis', category: 'Infectious'},
        {code: 'A07', description: 'Other protozoal intestinal diseases', category: 'Infectious'},
        {code: 'A08', description: 'Viral and other specified intestinal infections', category: 'Infectious'},
        {code: 'A09', description: 'Infectious gastroenteritis and colitis', category: 'Infectious'},
        {code: 'A15', description: 'Respiratory tuberculosis', category: 'Infectious'},
        {code: 'A16', description: 'Respiratory tuberculosis, not confirmed', category: 'Infectious'},
        {code: 'B01', description: 'Varicella [chickenpox]', category: 'Infectious'},
        {code: 'B02', description: 'Zoster [herpes zoster]', category: 'Infectious'},
        {code: 'B05', description: 'Measles', category: 'Infectious'},
        {code: 'B15', description: 'Acute hepatitis A', category: 'Infectious'},
        {code: 'B16', description: 'Acute hepatitis B', category: 'Infectious'},
        {code: 'B17', description: 'Other acute viral hepatitis', category: 'Infectious'},
        {code: 'B18', description: 'Chronic viral hepatitis', category: 'Infectious'},
        {code: 'B19', description: 'Unspecified viral hepatitis', category: 'Infectious'},
        
        // Respiratory
        {code: 'J00-J99', description: 'Diseases of the respiratory system', category: 'Respiratory'},
        {code: 'J00', description: 'Acute nasopharyngitis [common cold]', category: 'Respiratory'},
        {code: 'J01', description: 'Acute sinusitis', category: 'Respiratory'},
        {code: 'J02', description: 'Acute pharyngitis', category: 'Respiratory'},
        {code: 'J03', description: 'Acute tonsillitis', category: 'Respiratory'},
        {code: 'J04', description: 'Acute laryngitis and tracheitis', category: 'Respiratory'},
        {code: 'J05', description: 'Acute obstructive laryngitis and epiglottitis', category: 'Respiratory'},
        {code: 'J06', description: 'Acute upper respiratory infections', category: 'Respiratory'},
        {code: 'J06.9', description: 'Acute upper respiratory infection, unspecified', category: 'Respiratory'},
        {code: 'J10', description: 'Influenza due to identified influenza virus', category: 'Respiratory'},
        {code: 'J11', description: 'Influenza, virus not identified', category: 'Respiratory'},
        {code: 'J12', description: 'Viral pneumonia', category: 'Respiratory'},
        {code: 'J13', description: 'Pneumonia due to Streptococcus pneumoniae', category: 'Respiratory'},
        {code: 'J14', description: 'Pneumonia due to Haemophilus influenzae', category: 'Respiratory'},
        {code: 'J15', description: 'Bacterial pneumonia', category: 'Respiratory'},
        {code: 'J18', description: 'Pneumonia, organism unspecified', category: 'Respiratory'},
        {code: 'J18.9', description: 'Pneumonia, unspecified organism', category: 'Respiratory'},
        {code: 'J20', description: 'Acute bronchitis', category: 'Respiratory'},
        {code: 'J21', description: 'Acute bronchiolitis', category: 'Respiratory'},
        {code: 'J40', description: 'Bronchitis, not specified as acute or chronic', category: 'Respiratory'},
        {code: 'J42', description: 'Unspecified chronic bronchitis', category: 'Respiratory'},
        {code: 'J44', description: 'Chronic obstructive pulmonary disease', category: 'Respiratory'},
        {code: 'J45', description: 'Asthma', category: 'Respiratory'},
        {code: 'J45.0', description: 'Predominantly allergic asthma', category: 'Respiratory'},
        
        // Endocrine/Metabolic
        {code: 'E00-E89', description: 'Endocrine, nutritional and metabolic diseases', category: 'Endocrine'},
        {code: 'E10', description: 'Type 1 diabetes mellitus', category: 'Endocrine'},
        {code: 'E11', description: 'Type 2 diabetes mellitus', category: 'Endocrine'},
        {code: 'E11.9', description: 'Type 2 diabetes mellitus without complications', category: 'Endocrine'},
        {code: 'E11.65', description: 'Type 2 diabetes with hyperglycemia', category: 'Endocrine'},
        {code: 'E11.22', description: 'Type 2 diabetes with diabetic chronic kidney disease', category: 'Endocrine'},
        {code: 'E11.36', description: 'Type 2 diabetes with diabetic cataract', category: 'Endocrine'},
        {code: 'E03', description: 'Other hypothyroidism', category: 'Endocrine'},
        {code: 'E04', description: 'Other nontoxic goiter', category: 'Endocrine'},
        {code: 'E05', description: 'Thyrotoxicosis [hyperthyroidism]', category: 'Endocrine'},
        {code: 'E06', description: 'Thyroiditis', category: 'Endocrine'},
        {code: 'E66', description: 'Overweight and obesity', category: 'Endocrine'},
        {code: 'E78', description: 'Disorders of lipoprotein metabolism', category: 'Endocrine'},
        {code: 'E78.0', description: 'Pure hypercholesterolemia', category: 'Endocrine'},
        {code: 'E78.5', description: 'Hyperlipidemia, unspecified', category: 'Endocrine'},
        
        // Circulatory
        {code: 'I00-I99', description: 'Diseases of the circulatory system', category: 'Circulatory'},
        {code: 'I10', description: 'Essential (primary) hypertension', category: 'Circulatory'},
        {code: 'I11', description: 'Hypertensive heart disease', category: 'Circulatory'},
        {code: 'I12', description: 'Hypertensive chronic kidney disease', category: 'Circulatory'},
        {code: 'I13', description: 'Hypertensive heart and chronic kidney disease', category: 'Circulatory'},
        {code: 'I20', description: 'Angina pectoris', category: 'Circulatory'},
        {code: 'I21', description: 'Acute myocardial infarction', category: 'Circulatory'},
        {code: 'I25', description: 'Chronic ischemic heart disease', category: 'Circulatory'},
        {code: 'I48', description: 'Atrial fibrillation and flutter', category: 'Circulatory'},
        {code: 'I50', description: 'Heart failure', category: 'Circulatory'},
        {code: 'I63', description: 'Cerebral infarction', category: 'Circulatory'},
        {code: 'I64', description: 'Stroke, not specified', category: 'Circulatory'},
        
        // Digestive
        {code: 'K00-K93', description: 'Diseases of the digestive system', category: 'Digestive'},
        {code: 'K21', description: 'Gastro-esophageal reflux disease', category: 'Digestive'},
        {code: 'K25', description: 'Gastric ulcer', category: 'Digestive'},
        {code: 'K26', description: 'Duodenal ulcer', category: 'Digestive'},
        {code: 'K29', description: 'Gastritis and duodenitis', category: 'Digestive'},
        {code: 'K30', description: 'Functional dyspepsia', category: 'Digestive'},
        {code: 'K35', description: 'Acute appendicitis', category: 'Digestive'},
        {code: 'K40', description: 'Inguinal hernia', category: 'Digestive'},
        {code: 'K50', description: "Crohn's disease", category: 'Digestive'},
        {code: 'K51', description: 'Ulcerative colitis', category: 'Digestive'},
        {code: 'K52', description: 'Other noninfective gastroenteritis and colitis', category: 'Digestive'},
        {code: 'K58', description: 'Irritable bowel syndrome', category: 'Digestive'},
        {code: 'K59', description: 'Other functional intestinal disorders', category: 'Digestive'},
        {code: 'K80', description: 'Cholelithiasis', category: 'Digestive'},
        
        // Musculoskeletal
        {code: 'M00-M99', description: 'Diseases of the musculoskeletal system', category: 'Musculoskeletal'},
        {code: 'M05', description: 'Rheumatoid arthritis with rheumatoid factor', category: 'Musculoskeletal'},
        {code: 'M06', description: 'Other rheumatoid arthritis', category: 'Musculoskeletal'},
        {code: 'M10', description: 'Gout', category: 'Musculoskeletal'},
        {code: 'M15', description: 'Polyosteoarthritis', category: 'Musculoskeletal'},
        {code: 'M16', description: 'Osteoarthritis of hip', category: 'Musculoskeletal'},
        {code: 'M17', description: 'Osteoarthritis of knee', category: 'Musculoskeletal'},
        {code: 'M19', description: 'Other and unspecified osteoarthritis', category: 'Musculoskeletal'},
        {code: 'M25', description: 'Other joint disorder', category: 'Musculoskeletal'},
        {code: 'M54', description: 'Dorsalgia [back pain]', category: 'Musculoskeletal'},
        {code: 'M79', description: 'Other and unspecified soft tissue disorders', category: 'Musculoskeletal'},
        
        // Symptoms
        {code: 'R00-R99', description: 'Symptoms, signs and abnormal findings', category: 'Symptoms'},
        {code: 'R05', description: 'Cough', category: 'Symptoms'},
        {code: 'R06', description: 'Abnormalities of breathing', category: 'Symptoms'},
        {code: 'R07', description: 'Pain in throat and chest', category: 'Symptoms'},
        {code: 'R10', description: 'Abdominal and pelvic pain', category: 'Symptoms'},
        {code: 'R11', description: 'Nausea and vomiting', category: 'Symptoms'},
        {code: 'R19', description: 'Other symptoms involving digestive system', category: 'Symptoms'},
        {code: 'R50', description: 'Fever of other and unknown origin', category: 'Symptoms'},
        {code: 'R50.9', description: 'Fever, unspecified', category: 'Symptoms'},
        {code: 'R51', description: 'Headache', category: 'Symptoms'},
        {code: 'R52', description: 'Pain, unspecified', category: 'Symptoms'},
        {code: 'R53', description: 'Malaise and fatigue', category: 'Symptoms'},
        {code: 'R60', description: 'Edema', category: 'Symptoms'},
        {code: 'R63', description: 'Symptoms concerning food and fluid intake', category: 'Symptoms'}
      ],
      
      // SOAP TEMPLATES
      soap_templates: [
        {
          id: 't1',
          name: 'Viral Fever',
          icon: 'ü§í',
          chief_complaint: 'Fever for 3 days',
          subjective: 'Patient reports fever (102¬∞F) for 3 days, associated with body ache, headache, and mild cough. No breathlessness. Appetite reduced. Taking paracetamol with partial relief.',
          objective: 'Temperature: 101¬∞F, BP: 120/80 mmHg, Pulse: 88/min, SpO2: 98%. Throat: mild congestion. Chest: clear. No lymphadenopathy.',
          assessment: 'Viral fever (Acute upper respiratory tract infection)',
          plan: 'Paracetamol 500mg TDS for 5 days, Rest, Plenty of fluids, Steam inhalation. Review if fever persists >5 days or develops breathlessness.',
          icd10: 'J06.9'
        },
        {
          id: 't2',
          name: 'Acute Gastroenteritis',
          icon: 'ü§¢',
          chief_complaint: 'Loose motions and vomiting since yesterday',
          subjective: 'Patient reports 6-7 episodes of loose watery stools and 3 episodes of vomiting since yesterday. Mild abdominal cramps. No blood in stools. Reduced oral intake.',
          objective: 'Temperature: 99¬∞F, BP: 110/70 mmHg, Pulse: 92/min. Abdomen: soft, mild tenderness, increased bowel sounds. No dehydration signs.',
          assessment: 'Acute gastroenteritis',
          plan: 'ORS solution frequently, Light diet (BRAT), Probiotics, Zinc supplements. Avoid milk products. Review if symptoms worsen or blood in stools.',
          icd10: 'A09'
        },
        {
          id: 't3',
          name: 'Hypertension Follow-up',
          icon: 'üíä',
          chief_complaint: 'Follow-up for high blood pressure',
          subjective: 'Patient on antihypertensive medication for 3 months. Reports good compliance. No headache, dizziness, or chest pain. Regular exercise and low salt diet.',
          objective: 'BP: 130/85 mmHg, Pulse: 76/min, Weight: stable. Cardiovascular: S1 S2 normal, no murmurs.',
          assessment: 'Essential hypertension - controlled',
          plan: 'Continue current medication. Maintain lifestyle modifications. Check BP weekly at home. Follow-up in 3 months with lipid profile.',
          icd10: 'I10'
        },
        {
          id: 't4',
          name: 'Type 2 Diabetes Follow-up',
          icon: 'ü©∏',
          chief_complaint: 'Diabetes follow-up',
          subjective: 'Patient on oral hypoglycemic agents. Reports good compliance. Fasting sugars 110-130 mg/dL. No hypoglycemic episodes. Following diabetic diet.',
          objective: 'BP: 125/80 mmHg, Weight: stable, BMI: 26. Foot examination: normal. No retinopathy.',
          assessment: 'Type 2 diabetes mellitus - fair control',
          plan: 'Continue current medications. HbA1c test. Diabetic diet counseling. Regular exercise. Foot care education. Follow-up in 2 months.',
          icd10: 'E11.9'
        },
        {
          id: 't5',
          name: 'Common Cold',
          icon: 'ü§ß',
          chief_complaint: 'Cold and cough for 2 days',
          subjective: 'Patient reports runny nose, sneezing, mild sore throat, and dry cough for 2 days. No fever. No breathlessness.',
          objective: 'Temperature: 98.4¬∞F, BP: 118/78 mmHg, Pulse: 80/min. Throat: mild congestion. Chest: clear.',
          assessment: 'Acute nasopharyngitis (Common cold)',
          plan: 'Symptomatic treatment: Steam inhalation, Warm fluids, Antihistamine if needed. Rest. Review if symptoms worsen.',
          icd10: 'J00'
        }
      ],
      
      lab_tests: [
        {id: 'lab1', name: 'Complete Blood Count (CBC)', category: 'Hematology', price: 300, normal_range: 'WBC: 4-11k, RBC: 4.5-5.5M, Hb: 12-16g/dL, Platelets: 150-400k'},
        {id: 'lab2', name: 'Liver Function Test (LFT)', category: 'Biochemistry', price: 500, normal_range: 'SGOT: 5-40 U/L, SGPT: 7-56 U/L, Bilirubin: 0.3-1.2 mg/dL'},
        {id: 'lab3', name: 'Kidney Function Test (KFT)', category: 'Biochemistry', price: 450, normal_range: 'Creatinine: 0.7-1.3 mg/dL, Urea: 15-40 mg/dL, Uric Acid: 3.5-7.2 mg/dL'},
        {id: 'lab4', name: 'Lipid Profile', category: 'Biochemistry', price: 600, normal_range: 'Total Cholesterol: <200 mg/dL, LDL: <100 mg/dL, HDL: >40 mg/dL, Triglycerides: <150 mg/dL'},
        {id: 'lab5', name: 'Blood Sugar Fasting', category: 'Biochemistry', price: 100, normal_range: '70-100 mg/dL'},
        {id: 'lab6', name: 'HbA1c', category: 'Biochemistry', price: 400, normal_range: '<5.7% (Normal), 5.7-6.4% (Prediabetes), >6.5% (Diabetes)'},
        {id: 'lab7', name: 'Thyroid Profile (T3, T4, TSH)', category: 'Endocrinology', price: 550, normal_range: 'TSH: 0.4-4.0 mIU/L, T3: 80-200 ng/dL, T4: 5-12 Œºg/dL'},
        {id: 'lab8', name: 'Urine Routine', category: 'Pathology', price: 150, normal_range: 'pH: 4.5-8.0, No protein/glucose, WBC: 0-5/hpf'}
      ]
    };

    let currentScreen = 'consent';
    let currentUser = null;
    let userConsent = false;
    let currentPrescription = { patient_id: null, medicines: [], diagnosis: [] };
    let currentInvoice = { items: [], subtotal: 0, cgst: 0, sgst: 0, total: 0 };
    let isRecording = false;

    const supabase = {
      from: (table) => ({
        select: (cols) => ({
          order: (col, opts) => Promise.resolve({ data: window.DB[table] || [], error: null }),
          eq: (col, val) => Promise.resolve({ data: (window.DB[table] || []).filter(item => item[col] === val), error: null })
        }),
        insert: (data) => {
          const items = Array.isArray(data) ? data : [data];
          const newItems = items.map(item => ({ 
            id: 'uuid-' + Date.now() + '-' + Math.random(), 
            created_at: new Date().toISOString(), 
            ...item 
          }));
          window.DB[table] = window.DB[table] || [];
          window.DB[table].push(...newItems);
          return Promise.resolve({ data: newItems, error: null });
        },
        update: (data) => ({
          eq: (col, val) => {
            const items = window.DB[table] || [];
            const index = items.findIndex(item => item[col] === val);
            if (index !== -1) {
              items[index] = { ...items[index], ...data, updated_at: new Date().toISOString() };
            }
            return Promise.resolve({ data: items[index] ? [items[index]] : [], error: null });
          }
        })
      })
    };

    function getClinic() {
      return window.DB.clinics[0];
    }

    function showToast(msg, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Ñπ';
      toast.innerHTML = `<div class="text-2xl">${icon}</div><div><p class="font-semibold text-sm">${msg}</p></div>`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3500);
    }

    async function acceptConsent() {
      userConsent = true;
      currentScreen = 'login';
      render();
    }

    async function login() {
      currentUser = { 
        name: 'Dr. Rajesh Sharma', 
        email: 'doctor@clinic.com', 
        role: 'doctor'
      };
      currentScreen = 'dashboard';
      showToast('Phase 7 Week 2 Complete! All features active!', 'success');
      render();
    }

    function logout() {
      currentUser = null;
      userConsent = false;
      currentScreen = 'consent';
      render();
    }

    function switchScreen(screen) {
      currentScreen = screen;
      render();
      return false;
    }

    function closeModal() {
      document.querySelectorAll('.modal-overlay').forEach(m => m.remove());
    }

    // ENHANCED SOAP NOTES WITH TEMPLATES
    function showSOAPNotesModal(patientId) {
      const patient = window.DB.patients.find(p => p.id === patientId);
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <div>
              <h2 class="text-2xl font-bold">üìã SOAP Notes with Templates</h2>
              <p class="text-sm text-gray-600 mt-1">Patient: ${patient.first_name} ${patient.last_name || ''}</p>
            </div>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          
          <div class="p-8">
            <!-- Quick Templates -->
            <div class="mb-6">
              <h3 class="font-bold mb-3">üöÄ Quick Templates (NEW!)</h3>
              <div class="grid grid-cols-5 gap-3">
                ${window.DB.soap_templates.map(t => `
                  <div class="template-card p-4 rounded-xl text-center" onclick="applySOAPTemplate('${t.id}')">
                    <div class="text-3xl mb-2">${t.icon}</div>
                    <p class="font-semibold text-sm">${t.name}</p>
                  </div>
                `).join('')}
              </div>
            </div>

            <!-- Voice Input Button -->
            <div class="mb-6 p-4 bg-purple-50 rounded-xl border-2 border-purple-200">
              <div class="flex items-center justify-between">
                <div>
                  <p class="font-bold text-purple-900">üé§ Voice-to-Text (Coming in Phase 8!)</p>
                  <p class="text-sm text-purple-700">Click microphone to dictate notes</p>
                </div>
                <button onclick="toggleVoiceRecording()" class="btn btn-purple voice-btn" id="voiceBtn">
                  üé§ Start Recording
                </button>
              </div>
            </div>

            <div class="mb-6">
              <label class="form-label">Chief Complaint</label>
              <input type="text" id="chiefComplaintSOAP" class="form-input" placeholder="e.g., Fever for 3 days">
            </div>

            <div class="mb-6">
              <label class="form-label">S - Subjective</label>
              <textarea id="subjective" class="form-input" rows="3" placeholder="Patient's complaints..."></textarea>
            </div>

            <div class="mb-6">
              <label class="form-label">O - Objective</label>
              <textarea id="objective" class="form-input" rows="3" placeholder="Examination findings..."></textarea>
            </div>

            <div class="mb-6">
              <label class="form-label">A - Assessment</label>
              <textarea id="assessment" class="form-input" rows="2" placeholder="Diagnosis..."></textarea>
            </div>

            <div class="mb-6">
              <label class="form-label">P - Plan</label>
              <textarea id="plan" class="form-input" rows="3" placeholder="Treatment plan..."></textarea>
            </div>

            <div class="flex gap-4">
              <button onclick="saveSOAPNotes('${patientId}')" class="btn btn-success">üíæ Save SOAP Notes</button>
              <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function applySOAPTemplate(templateId) {
      const template = window.DB.soap_templates.find(t => t.id === templateId);
      if (template) {
        document.getElementById('chiefComplaintSOAP').value = template.chief_complaint;
        document.getElementById('subjective').value = template.subjective;
        document.getElementById('objective').value = template.objective;
        document.getElementById('assessment').value = template.assessment;
        document.getElementById('plan').value = template.plan;
        showToast(`Template "${template.name}" applied!`, 'success');
        
        // Highlight selected template
        document.querySelectorAll('.template-card').forEach(card => card.classList.remove('selected'));
        event.target.closest('.template-card').classList.add('selected');
      }
    }

    function toggleVoiceRecording() {
      isRecording = !isRecording;
      const btn = document.getElementById('voiceBtn');
      
      if (isRecording) {
        btn.textContent = '‚èπÔ∏è Stop Recording';
        btn.classList.add('recording');
        showToast('Voice recording started (Demo - Phase 8 feature)', 'info');
        
        // Simulate voice recording (will be real in Phase 8)
        setTimeout(() => {
          if (isRecording) {
            toggleVoiceRecording();
            showToast('Voice-to-text will be available in Phase 8!', 'info');
          }
        }, 3000);
      } else {
        btn.textContent = 'üé§ Start Recording';
        btn.classList.remove('recording');
        showToast('Recording stopped', 'info');
      }
    }

    async function saveSOAPNotes(patientId) {
      const soapData = {
        patient_id: patientId,
        chief_complaint: document.getElementById('chiefComplaintSOAP').value,
        subjective: document.getElementById('subjective').value,
        objective: document.getElementById('objective').value,
        assessment: document.getElementById('assessment').value,
        plan: document.getElementById('plan').value
      };

      await supabase.from('soap_notes').insert([soapData]);
      showToast('SOAP notes saved!', 'success');
      closeModal();
      render();
    }

    // ENHANCED ICD-10 SEARCH
    function showICD10SearchModal() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <div>
              <h2 class="text-2xl font-bold">üîç ICD-10 Diagnosis Codes</h2>
              <p class="text-sm text-gray-600 mt-1">100+ codes available (NEW!)</p>
            </div>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          <div class="p-8">
            <div class="mb-6">
              <input type="text" id="icd10Search" class="form-input" placeholder="Search by code or description..." oninput="searchICD10(this.value)">
            </div>

            <!-- Category Filter -->
            <div class="mb-6">
              <div class="flex gap-2 flex-wrap">
                <button onclick="filterICD10Category('all')" class="btn btn-sm btn-primary">All</button>
                <button onclick="filterICD10Category('Infectious')" class="btn btn-sm btn-secondary">Infectious</button>
                <button onclick="filterICD10Category('Respiratory')" class="btn btn-sm btn-secondary">Respiratory</button>
                <button onclick="filterICD10Category('Endocrine')" class="btn btn-sm btn-secondary">Endocrine</button>
                <button onclick="filterICD10Category('Circulatory')" class="btn btn-sm btn-secondary">Circulatory</button>
                <button onclick="filterICD10Category('Digestive')" class="btn btn-sm btn-secondary">Digestive</button>
                <button onclick="filterICD10Category('Musculoskeletal')" class="btn btn-sm btn-secondary">Musculoskeletal</button>
                <button onclick="filterICD10Category('Symptoms')" class="btn btn-sm btn-secondary">Symptoms</button>
              </div>
            </div>

            <div id="icd10Results" class="space-y-3 max-h-96 overflow-y-auto">
              ${window.DB.icd10_codes.slice(0, 20).map(code => `
                <div class="p-4 border rounded-xl hover:bg-blue-50 cursor-pointer transition">
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <p class="font-bold text-blue-600">${code.code}</p>
                      <p class="text-sm text-gray-700">${code.description}</p>
                      ${code.category ? `<span class="badge badge-primary mt-1">${code.category}</span>` : ''}
                    </div>
                    <button onclick="selectICD10('${code.code}', '${code.description}')" class="btn btn-sm btn-primary">Select</button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function searchICD10(query) {
      if (!query || query.length < 2) {
        document.getElementById('icd10Results').innerHTML = window.DB.icd10_codes.slice(0, 20).map(code => `
          <div class="p-4 border rounded-xl hover:bg-blue-50">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <p class="font-bold text-blue-600">${code.code}</p>
                <p class="text-sm text-gray-700">${code.description}</p>
                ${code.category ? `<span class="badge badge-primary mt-1">${code.category}</span>` : ''}
              </div>
              <button onclick="selectICD10('${code.code}', '${code.description}')" class="btn btn-sm btn-primary">Select</button>
            </div>
          </div>
        `).join('');
        return;
      }

      const results = window.DB.icd10_codes.filter(code => 
        code.code.toLowerCase().includes(query.toLowerCase()) ||
        code.description.toLowerCase().includes(query.toLowerCase())
      );

      document.getElementById('icd10Results').innerHTML = results.map(code => `
        <div class="p-4 border rounded-xl hover:bg-blue-50">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <p class="font-bold text-blue-600">${code.code}</p>
              <p class="text-sm text-gray-700">${code.description}</p>
              ${code.category ? `<span class="badge badge-primary mt-1">${code.category}</span>` : ''}
            </div>
            <button onclick="selectICD10('${code.code}', '${code.description}')" class="btn btn-sm btn-primary">Select</button>
          </div>
        </div>
      `).join('');
    }

    function filterICD10Category(category) {
      const results = category === 'all' 
        ? window.DB.icd10_codes.slice(0, 20)
        : window.DB.icd10_codes.filter(code => code.category === category);

      document.getElementById('icd10Results').innerHTML = results.map(code => `
        <div class="p-4 border rounded-xl hover:bg-blue-50">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <p class="font-bold text-blue-600">${code.code}</p>
              <p class="text-sm text-gray-700">${code.description}</p>
              ${code.category ? `<span class="badge badge-primary mt-1">${code.category}</span>` : ''}
            </div>
            <button onclick="selectICD10('${code.code}', '${code.description}')" class="btn btn-sm btn-primary">Select</button>
          </div>
        </div>
      `).join('');
    }

    function selectICD10(code, description) {
      showToast(`Selected: ${code} - ${description}`, 'success');
      closeModal();
    }

    // LAB RESULT ENTRY
    function showLabResultModal(orderId) {
      const order = window.DB.lab_orders.find(o => o.id === orderId);
      const patient = window.DB.patients.find(p => p.id === order.patient_id);
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <div>
              <h2 class="text-2xl font-bold">üî¨ Enter Lab Results (NEW!)</h2>
              <p class="text-sm text-gray-600 mt-1">Patient: ${patient.first_name} ${patient.last_name || ''}</p>
            </div>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          <div class="p-8">
            <div class="space-y-6">
              ${order.tests.map((test, idx) => `
                <div class="p-6 border-2 rounded-xl">
                  <h3 class="font-bold text-lg mb-4">${test.name}</h3>
                  <p class="text-sm text-gray-600 mb-4">Normal Range: ${test.normal_range}</p>
                  
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="form-label">Result Value</label>
                      <input type="text" id="result_${idx}" class="form-input result-input" placeholder="Enter value" oninput="checkNormalRange(${idx}, '${test.normal_range}')">
                    </div>
                    <div>
                      <label class="form-label">Unit</label>
                      <input type="text" id="unit_${idx}" class="form-input" placeholder="mg/dL, U/L, etc.">
                    </div>
                  </div>
                  
                  <div class="mt-4">
                    <label class="form-label">Remarks</label>
                    <textarea id="remarks_${idx}" class="form-input" rows="2" placeholder="Any additional notes..."></textarea>
                  </div>
                  
                  <div id="status_${idx}" class="mt-3"></div>
                </div>
              `).join('')}
            </div>

            <div class="flex gap-4 mt-6">
              <button onclick="saveLabResults('${orderId}')" class="btn btn-success">üíæ Save Results</button>
              <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function checkNormalRange(idx, normalRange) {
      const input = document.getElementById(`result_${idx}`);
      const statusDiv = document.getElementById(`status_${idx}`);
      const value = parseFloat(input.value);
      
      if (!value) {
        input.className = 'form-input result-input';
        statusDiv.innerHTML = '';
        return;
      }

      // Simple range check (can be enhanced)
      const ranges = normalRange.match(/(\d+\.?\d*)-(\d+\.?\d*)/);
      if (ranges) {
        const min = parseFloat(ranges[1]);
        const max = parseFloat(ranges[2]);
        
        if (value < min || value > max) {
          input.className = 'form-input result-input abnormal';
          statusDiv.innerHTML = '<p class="text-red-600 font-bold">‚ö†Ô∏è ABNORMAL - Outside normal range</p>';
        } else {
          input.className = 'form-input result-input normal';
          statusDiv.innerHTML = '<p class="text-green-600 font-bold">‚úì NORMAL - Within range</p>';
        }
      }
    }

    async function saveLabResults(orderId) {
      const order = window.DB.lab_orders.find(o => o.id === orderId);
      const results = order.tests.map((test, idx) => ({
        test_name: test.name,
        result_value: document.getElementById(`result_${idx}`).value,
        unit: document.getElementById(`unit_${idx}`).value,
        remarks: document.getElementById(`remarks_${idx}`).value,
        normal_range: test.normal_range
      }));

      const resultData = {
        order_id: orderId,
        patient_id: order.patient_id,
        results: results,
        status: 'completed'
      };

      await supabase.from('lab_results').insert([resultData]);
      await supabase.from('lab_orders').update({ status: 'completed' }).eq('id', orderId);
      
      showToast('Lab results saved successfully!', 'success');
      closeModal();
      render();
    }

    // VITAL SIGNS WITH TREND GRAPH
    function showVitalTrendsModal(patientId) {
      const patient = window.DB.patients.find(p => p.id === patientId);
      const vitals = window.DB.vital_signs.filter(v => v.patient_id === patientId).slice(-6);
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <div>
              <h2 class="text-2xl font-bold">üìä Vital Signs Trends (NEW!)</h2>
              <p class="text-sm text-gray-600 mt-1">Patient: ${patient.first_name} ${patient.last_name || ''}</p>
            </div>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          <div class="p-8">
            ${vitals.length === 0 ? `
              <div class="text-center py-12">
                <div class="text-6xl mb-4">üìä</div>
                <p class="text-xl text-gray-600">No vital signs recorded yet</p>
                <button onclick="closeModal(); showVitalSignsModal('${patientId}')" class="btn btn-primary mt-4">Record First Vitals</button>
              </div>
            ` : `
              <div class="mb-8">
                <canvas id="vitalChart" width="400" height="200"></canvas>
              </div>

              <div class="grid grid-cols-2 gap-6">
                <div class="card">
                  <h3 class="font-bold mb-4">Latest Vitals</h3>
                  ${vitals.length > 0 ? `
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span>BP:</span>
                        <span class="font-bold">${vitals[vitals.length-1].bp_systolic}/${vitals[vitals.length-1].bp_diastolic} mmHg</span>
                      </div>
                      <div class="flex justify-between">
                        <span>Pulse:</span>
                        <span class="font-bold">${vitals[vitals.length-1].pulse} bpm</span>
                      </div>
                      <div class="flex justify-between">
                        <span>Temp:</span>
                        <span class="font-bold">${vitals[vitals.length-1].temperature}¬∞F</span>
                      </div>
                      <div class="flex justify-between">
                        <span>SpO2:</span>
                        <span class="font-bold">${vitals[vitals.length-1].spo2}%</span>
                      </div>
                      <div class="flex justify-between">
                        <span>BMI:</span>
                        <span class="font-bold">${vitals[vitals.length-1].bmi || 'N/A'}</span>
                      </div>
                    </div>
                  ` : ''}
                </div>

                <div class="card">
                  <h3 class="font-bold mb-4">History</h3>
                  <div class="space-y-2 text-sm">
                    <p>Total Records: <span class="font-bold">${vitals.length}</span></p>
                    <p>First Record: <span class="font-bold">${vitals.length > 0 ? new Date(vitals[0].created_at).toLocaleDateString() : 'N/A'}</span></p>
                    <p>Last Record: <span class="font-bold">${vitals.length > 0 ? new Date(vitals[vitals.length-1].created_at).toLocaleDateString() : 'N/A'}</span></p>
                  </div>
                </div>
              </div>

              <div class="mt-6">
                <button onclick="closeModal(); showVitalSignsModal('${patientId}')" class="btn btn-primary">üìù Record New Vitals</button>
              </div>
            `}
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      if (vitals.length > 0) {
        // Create chart
        setTimeout(() => {
          const ctx = document.getElementById('vitalChart').getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: vitals.map((v, i) => `Visit ${i + 1}`),
              datasets: [
                {
                  label: 'Systolic BP',
                  data: vitals.map(v => v.bp_systolic),
                  borderColor: 'rgb(239, 68, 68)',
                  backgroundColor: 'rgba(239, 68, 68, 0.1)',
                  tension: 0.4
                },
                {
                  label: 'Diastolic BP',
                  data: vitals.map(v => v.bp_diastolic),
                  borderColor: 'rgb(59, 130, 246)',
                  backgroundColor: 'rgba(59, 130, 246, 0.1)',
                  tension: 0.4
                },
                {
                  label: 'Pulse',
                  data: vitals.map(v => v.pulse),
                  borderColor: 'rgb(16, 185, 129)',
                  backgroundColor: 'rgba(16, 185, 129, 0.1)',
                  tension: 0.4
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: 'Vital Signs Trend (Last 6 Visits)'
                }
              },
              scales: {
                y: {
                  beginAtZero: false
                }
              }
            }
          });
        }, 100);
      }
    }

    // VITAL SIGNS RECORDING
    function showVitalSignsModal(patientId) {
      const patient = window.DB.patients.find(p => p.id === patientId);
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <div>
              <h2 class="text-2xl font-bold">ü©∫ Record Vital Signs</h2>
              <p class="text-sm text-gray-600 mt-1">Patient: ${patient.first_name} ${patient.last_name || ''}</p>
            </div>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          <div class="p-8">
            <div class="grid grid-cols-3 gap-6 mb-6">
              <div>
                <label class="form-label">BP (mmHg)</label>
                <div class="flex gap-2">
                  <input type="number" id="bpSystolic" class="form-input" style="width: 100px;" placeholder="120">
                  <span class="text-2xl">/</span>
                  <input type="number" id="bpDiastolic" class="form-input" style="width: 100px;" placeholder="80">
                </div>
              </div>
              <div>
                <label class="form-label">Pulse (bpm)</label>
                <input type="number" id="pulse" class="form-input" placeholder="72">
              </div>
              <div>
                <label class="form-label">Temp (¬∞F)</label>
                <input type="number" step="0.1" id="temperature" class="form-input" placeholder="98.6">
              </div>
            </div>

            <div class="grid grid-cols-3 gap-6 mb-6">
              <div>
                <label class="form-label">SpO2 (%)</label>
                <input type="number" id="spo2" class="form-input" placeholder="98">
              </div>
              <div>
                <label class="form-label">Weight (kg)</label>
                <input type="number" step="0.1" id="weight" class="form-input" placeholder="70">
              </div>
              <div>
                <label class="form-label">Height (cm)</label>
                <input type="number" id="height" class="form-input" placeholder="170">
              </div>
            </div>

            <div class="mb-6 p-4 bg-blue-50 rounded-xl">
              <p class="font-bold text-blue-900">BMI: <span id="bmiDisplay">--</span></p>
              <p class="text-sm text-blue-700 mt-1" id="bmiCategory">Enter weight and height</p>
            </div>

            <div class="flex gap-4">
              <button onclick="saveVitalSigns('${patientId}')" class="btn btn-success">üíæ Save</button>
              <button onclick="showVitalTrendsModal('${patientId}')" class="btn btn-info">üìä View Trends</button>
              <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      const weightInput = document.getElementById('weight');
      const heightInput = document.getElementById('height');
      
      function calculateBMI() {
        const weight = parseFloat(weightInput.value);
        const height = parseFloat(heightInput.value) / 100;
        
        if (weight && height) {
          const bmi = (weight / (height * height)).toFixed(1);
          document.getElementById('bmiDisplay').textContent = bmi;
          
          let category = '';
          if (bmi < 18.5) category = 'Underweight';
          else if (bmi < 25) category = 'Normal';
          else if (bmi < 30) category = 'Overweight';
          else category = 'Obese';
          
          document.getElementById('bmiCategory').textContent = `Category: ${category}`;
        }
      }
      
      weightInput.addEventListener('input', calculateBMI);
      heightInput.addEventListener('input', calculateBMI);
    }

    async function saveVitalSigns(patientId) {
      const bpSystolic = document.getElementById('bpSystolic').value;
      const bpDiastolic = document.getElementById('bpDiastolic').value;
      const weight = document.getElementById('weight').value;
      const height = document.getElementById('height').value;
      const bmi = weight && height ? (weight / Math.pow(height / 100, 2)).toFixed(1) : null;

      const vitalData = {
        patient_id: patientId,
        bp_systolic: bpSystolic,
        bp_diastolic: bpDiastolic,
        pulse: document.getElementById('pulse').value,
        temperature: document.getElementById('temperature').value,
        spo2: document.getElementById('spo2').value,
        weight: weight,
        height: height,
        bmi: bmi
      };

      await supabase.from('vital_signs').insert([vitalData]);
      
      const alerts = [];
      if (bpSystolic > 140 || bpDiastolic > 90) alerts.push('High BP');
      if (document.getElementById('temperature').value > 99.5) alerts.push('Fever');
      if (document.getElementById('spo2').value < 95) alerts.push('Low SpO2');
      
      if (alerts.length > 0) {
        showToast(`‚ö†Ô∏è Abnormal: ${alerts.join(', ')}`, 'warning');
      } else {
        showToast('Vital signs recorded!', 'success');
      }
      
      closeModal();
      render();
    }

    // LAB ORDERS
    function showLabOrderModal(patientId) {
      const patient = window.DB.patients.find(p => p.id === patientId);
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <div>
              <h2 class="text-2xl font-bold">üî¨ Lab Orders</h2>
              <p class="text-sm text-gray-600 mt-1">Patient: ${patient.first_name} ${patient.last_name || ''}</p>
            </div>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          <div class="p-8">
            <div class="mb-6">
              <input type="text" id="labTestSearch" class="form-input" placeholder="Search tests..." oninput="searchLabTests(this.value)">
            </div>

            <div id="labTestResults" class="space-y-3 mb-6 max-h-96 overflow-y-auto">
              ${window.DB.lab_tests.map(test => `
                <div class="p-4 border rounded-xl hover:bg-blue-50">
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <p class="font-bold">${test.name}</p>
                      <p class="text-sm text-gray-600">${test.category} ‚Ä¢ ‚Çπ${test.price}</p>
                      <p class="text-xs text-gray-500 mt-1">Normal: ${test.normal_range}</p>
                    </div>
                    <button onclick="addLabTest('${test.id}')" class="btn btn-primary">Add</button>
                  </div>
                </div>
              `).join('')}
            </div>

            <div id="selectedTests" class="mb-6">
              <h3 class="font-bold mb-3">Selected (0)</h3>
              <div id="selectedTestsList"></div>
            </div>

            <div class="flex gap-4">
              <button onclick="submitLabOrder('${patientId}')" class="btn btn-success">Submit</button>
              <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      window.selectedLabTests = [];
    }

    function searchLabTests(query) {
      if (!query || query.length < 2) {
        document.getElementById('labTestResults').innerHTML = window.DB.lab_tests.map(test => `
          <div class="p-4 border rounded-xl hover:bg-blue-50">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <p class="font-bold">${test.name}</p>
                <p class="text-sm text-gray-600">${test.category} ‚Ä¢ ‚Çπ${test.price}</p>
                <p class="text-xs text-gray-500 mt-1">Normal: ${test.normal_range}</p>
              </div>
              <button onclick="addLabTest('${test.id}')" class="btn btn-primary">Add</button>
            </div>
          </div>
        `).join('');
        return;
      }

      const results = window.DB.lab_tests.filter(test => 
        test.name.toLowerCase().includes(query.toLowerCase())
      );

      document.getElementById('labTestResults').innerHTML = results.map(test => `
        <div class="p-4 border rounded-xl hover:bg-blue-50">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <p class="font-bold">${test.name}</p>
              <p class="text-sm text-gray-600">${test.category} ‚Ä¢ ‚Çπ${test.price}</p>
              <p class="text-xs text-gray-500 mt-1">Normal: ${test.normal_range}</p>
            </div>
            <button onclick="addLabTest('${test.id}')" class="btn btn-primary">Add</button>
          </div>
        </div>
      `).join('');
    }

    function addLabTest(testId) {
      const test = window.DB.lab_tests.find(t => t.id === testId);
      if (!window.selectedLabTests.find(t => t.id === testId)) {
        window.selectedLabTests.push(test);
        updateSelectedTestsList();
      }
    }

    function removeLabTest(testId) {
      window.selectedLabTests = window.selectedLabTests.filter(t => t.id !== testId);
      updateSelectedTestsList();
    }

    function updateSelectedTestsList() {
      const total = window.selectedLabTests.reduce((sum, test) => sum + test.price, 0);
      document.querySelector('#selectedTests h3').textContent = `Selected (${window.selectedLabTests.length}) - ‚Çπ${total}`;
      
      document.getElementById('selectedTestsList').innerHTML = window.selectedLabTests.map(test => `
        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg mb-2">
          <div>
            <p class="font-semibold text-sm">${test.name}</p>
            <p class="text-xs text-gray-600">‚Çπ${test.price}</p>
          </div>
          <button onclick="removeLabTest('${test.id}')" class="text-red-600">‚úï</button>
        </div>
      `).join('');
    }

    async function submitLabOrder(patientId) {
      if (window.selectedLabTests.length === 0) {
        showToast('Select at least one test', 'error');
        return;
      }

      const orderData = {
        patient_id: patientId,
        tests: window.selectedLabTests,
        total_amount: window.selectedLabTests.reduce((sum, test) => sum + test.price, 0),
        status: 'pending'
      };

      await supabase.from('lab_orders').insert([orderData]);
      showToast(`Lab order created! ${window.selectedLabTests.length} tests`, 'success');
      closeModal();
      render();
    }

    // OPD QUEUE
    function showAddToQueueModal() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <h2 class="text-2xl font-bold">üé´ Add to OPD Queue</h2>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          <div class="p-8">
            <div class="mb-6">
              <label class="form-label">Select Patient</label>
              <select id="queuePatient" class="form-input">
                <option value="">Select Patient</option>
                ${window.DB.patients.map(p => `<option value="${p.id}">${p.first_name} ${p.last_name || ''} (${p.patient_id})</option>`).join('')}
              </select>
            </div>

            <div class="grid grid-cols-2 gap-6 mb-6">
              <div>
                <label class="form-label">Visit Type</label>
                <select id="visitType" class="form-input">
                  <option value="new">New Visit</option>
                  <option value="follow_up">Follow-up</option>
                  <option value="emergency">Emergency</option>
                </select>
              </div>
              <div>
                <label class="form-label">Doctor</label>
                <select id="queueDoctor" class="form-input">
                  <option value="Dr. Rajesh Sharma">Dr. Rajesh Sharma</option>
                </select>
              </div>
            </div>

            <div class="mb-6">
              <label class="form-label">Chief Complaint</label>
              <input type="text" id="chiefComplaint" class="form-input" placeholder="e.g., Fever, Cough">
            </div>

            <div class="flex gap-4">
              <button onclick="addToQueue()" class="btn btn-success">üé´ Generate Token</button>
              <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    async function addToQueue() {
      const patientId = document.getElementById('queuePatient').value;
      const visitType = document.getElementById('visitType').value;
      const doctor = document.getElementById('queueDoctor').value;
      const complaint = document.getElementById('chiefComplaint').value;

      if (!patientId) {
        showToast('Please select a patient', 'error');
        return;
      }

      const patient = window.DB.patients.find(p => p.id === patientId);
      const today = new Date().toISOString().split('T')[0];
      const todayQueue = window.DB.opd_queue.filter(q => q.date === today && q.status !== 'completed');
      const tokenNumber = todayQueue.length + 1;

      const queueEntry = {
        patient_id: patientId,
        patient_name: `${patient.first_name} ${patient.last_name || ''}`,
        token_number: tokenNumber,
        visit_type: visitType,
        doctor: doctor,
        chief_complaint: complaint,
        status: visitType === 'emergency' ? 'priority' : 'waiting',
        date: today,
        check_in_time: new Date().toISOString(),
        estimated_wait_time: tokenNumber * 10
      };

      await supabase.from('opd_queue').insert([queueEntry]);
      showToast(`Token #${tokenNumber} generated!`, 'success');
      closeModal();
      render();
    }

    async function updateQueueStatus(queueId, status) {
      await supabase.from('opd_queue').update({ status }).eq('id', queueId);
      showToast(`Status updated to: ${status}`, 'success');
      render();
    }

    function showQueueDisplay() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      const today = new Date().toISOString().split('T')[0];
      const todayQueue = window.DB.opd_queue.filter(q => q.date === today);
      const currentPatient = todayQueue.find(q => q.status === 'in_consultation');
      const waitingQueue = todayQueue.filter(q => q.status === 'waiting' || q.status === 'priority').sort((a, b) => {
        if (a.status === 'priority') return -1;
        if (b.status === 'priority') return 1;
        return a.token_number - b.token_number;
      });

      modal.innerHTML = `
        <div class="modal-content" style="max-width: 1400px;">
          <div class="p-8 border-b flex justify-between items-center bg-gradient-to-r from-blue-600 to-purple-600 text-white">
            <div>
              <h2 class="text-3xl font-bold">üì∫ OPD Queue Display</h2>
              <p class="text-sm opacity-90 mt-1">${new Date().toLocaleDateString()}</p>
            </div>
            <button onclick="closeModal()" class="text-white hover:text-gray-200 text-3xl">√ó</button>
          </div>
          <div class="p-8 bg-gray-50">
            <div class="mb-8 p-8 bg-white rounded-2xl shadow-xl text-center">
              <p class="text-lg text-gray-600 mb-4">NOW CONSULTING</p>
              ${currentPatient ? `
                <div style="font-size: 120px; font-weight: 900; line-height: 1; background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: pulse 2s infinite;">${currentPatient.token_number}</div>
                <p class="text-2xl font-bold mt-4">${currentPatient.patient_name}</p>
              ` : `
                <div class="text-6xl mb-4">‚è≥</div>
                <p class="text-xl text-gray-500">Waiting for next patient...</p>
              `}
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8">
              <h3 class="text-2xl font-bold mb-6">Waiting Queue (${waitingQueue.length})</h3>
              <div class="grid grid-cols-5 gap-4">
                ${waitingQueue.slice(0, 10).map(q => `
                  <div class="p-6 bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl text-center border-2 ${q.status === 'priority' ? 'border-red-500' : 'border-blue-200'}">
                    <div class="text-5xl font-bold text-blue-600 mb-2">${q.token_number}</div>
                    <p class="font-semibold text-sm">${q.patient_name}</p>
                    ${q.status === 'priority' ? '<p class="text-xs text-red-600 font-bold mt-1">üö® PRIORITY</p>' : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function render() {
      const app = document.getElementById('app');
      const clinic = getClinic();
      
      if (currentScreen === 'consent') {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-6" style="background: linear-gradient(135deg, #ff9933 0%, #ffffff 50%, #138808 100%);">
            <div class="w-full max-w-2xl">
              <div class="text-center mb-10">
                <img src="${clinic.logo_url}" class="h-20 mx-auto mb-6">
                <h1 class="text-4xl font-bold text-gray-900 mb-3">${clinic.name}</h1>
                <p class="text-xl text-gray-700">Phase 7 Week 2 Complete!</p>
              </div>
              <div class="card">
                <h2 class="text-2xl font-bold mb-4">üìã Data Privacy Consent</h2>
                <p class="text-gray-700 mb-4">As per DPDP Act 2023, we require your consent.</p>
                <button onclick="acceptConsent()" class="btn btn-primary w-full">Accept & Continue</button>
              </div>
            </div>
          </div>
        `;
      } else if (currentScreen === 'login') {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-6" style="background: linear-gradient(135deg, ${clinic.primary_color} 0%, ${clinic.secondary_color} 100%);">
            <div class="w-full max-w-md">
              <div class="text-center mb-10">
                <img src="${clinic.logo_url}" class="h-16 mx-auto mb-6">
                <h1 class="text-4xl font-bold text-white mb-3">${clinic.name}</h1>
                <p class="text-white text-lg">Phase 7 Week 2 Complete</p>
              </div>
              <div class="card">
                <input type="email" value="doctor@clinic.com" class="form-input mb-4">
                <button onclick="login()" class="btn btn-primary w-full">Login</button>
              </div>
            </div>
          </div>
        `;
      } else {
        app.innerHTML = `
          <div>
            <nav class="bg-gray-900 text-white p-5 flex justify-between sticky top-0 z-50">
              <div class="flex gap-4 items-center">
                <img src="${clinic.logo_url}" class="h-10">
                <div>
                  <h3 class="font-bold">${clinic.name}</h3>
                  <p class="text-xs text-gray-300">Phase 7 Week 2 Complete ‚úÖ</p>
                </div>
              </div>
              <div class="flex items-center gap-4">
                <div class="text-right">
                  <p class="font-semibold">${currentUser?.name}</p>
                  <p class="text-xs text-gray-300">${currentUser?.email}</p>
                </div>
                <button onclick="logout()" class="px-4 py-2 bg-white bg-opacity-10 rounded-lg hover:bg-opacity-20">Logout</button>
              </div>
            </nav>
            <div class="flex">
              <aside class="w-72 bg-gray-800 text-white p-6 min-h-screen">
                <div class="mb-6 p-4 rounded-xl" style="background: linear-gradient(135deg, ${clinic.primary_color} 0%, ${clinic.secondary_color} 100%);">
                  <p class="text-xs font-bold">‚úÖ WEEK 2 COMPLETE</p>
                  <p class="text-xs mt-1">All Phase 7 Features</p>
                </div>
                <nav class="space-y-2">
                  <a onclick="switchScreen('dashboard')" class="nav-link ${currentScreen==='dashboard'?'active':''}">üìä Dashboard</a>
                  <a onclick="switchScreen('opd_queue')" class="nav-link ${currentScreen==='opd_queue'?'active':''}">üé´ OPD Queue</a>
                  <a onclick="switchScreen('patients')" class="nav-link ${currentScreen==='patients'?'active':''}">üë• Patients</a>
                  <a onclick="switchScreen('lab_orders')" class="nav-link ${currentScreen==='lab_orders'?'active':''}">üî¨ Lab Orders</a>
                </nav>
              </aside>
              <main class="flex-1 p-8">${renderContent()}</main>
            </div>
          </div>
        `;
      }
    }

    function renderContent() {
      const clinic = getClinic();
      
      if (currentScreen === 'dashboard') {
        const today = new Date().toISOString().split('T')[0];
        const todayQueue = window.DB.opd_queue.filter(q => q.date === today);

        return `
          <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-8">Phase 7 Week 2 - Complete!</h1>
            
            <div class="mb-8 p-6 rounded-xl border-l-4" style="background: linear-gradient(135deg, ${clinic.primary_color}15 0%, ${clinic.secondary_color}15 100%); border-left-color: ${clinic.primary_color};">
              <div class="flex items-center gap-4">
                <div class="text-4xl">‚úÖ</div>
                <div>
                  <p class="font-bold text-lg" style="color: ${clinic.primary_color};">WEEK 2 COMPLETE!</p>
                  <p class="text-sm text-gray-700">SOAP Templates ‚Ä¢ 100+ ICD-10 Codes ‚Ä¢ Lab Results ‚Ä¢ Vital Trends ‚Ä¢ Voice-to-Text Ready</p>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-4 gap-6 mb-8">
              <div class="card">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 rounded-xl flex items-center justify-center text-white text-2xl" style="background: ${clinic.primary_color};">üé´</div>
                  <div>
                    <p class="text-gray-600 text-sm">OPD Queue</p>
                    <p class="text-3xl font-bold">${todayQueue.length}</p>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 rounded-xl flex items-center justify-center text-white text-2xl" style="background: ${clinic.secondary_color};">üë•</div>
                  <div>
                    <p class="text-gray-600 text-sm">Patients</p>
                    <p class="text-3xl font-bold">${window.DB.patients.length}</p>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center text-white text-2xl">üìã</div>
                  <div>
                    <p class="text-gray-600 text-sm">SOAP Notes</p>
                    <p class="text-3xl font-bold">${window.DB.soap_notes.length}</p>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center text-white text-2xl">üî¨</div>
                  <div>
                    <p class="text-gray-600 text-sm">Lab Orders</p>
                    <p class="text-3xl font-bold">${window.DB.lab_orders.length}</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
              <div class="card">
                <h3 class="text-xl font-bold mb-4">üéØ Quick Actions</h3>
                <div class="space-y-3">
                  <button onclick="showAddToQueueModal()" class="btn btn-primary w-full">üé´ Add to Queue</button>
                  <button onclick="showQueueDisplay()" class="btn btn-info w-full">üì∫ Queue Display</button>
                  <button onclick="showICD10SearchModal()" class="btn btn-warning w-full">üîç ICD-10 Search (100+ codes)</button>
                </div>
              </div>
              <div class="card">
                <h3 class="text-xl font-bold mb-4">üÜï Week 2 Features</h3>
                <div class="space-y-2 text-sm">
                  <div class="flex items-center gap-2">
                    <span class="text-green-600">‚úì</span>
                    <span>5 SOAP Templates</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-green-600">‚úì</span>
                    <span>100+ ICD-10 Codes</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-green-600">‚úì</span>
                    <span>Lab Result Entry</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-green-600">‚úì</span>
                    <span>Vital Signs Trends</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-purple-600">üé§</span>
                    <span>Voice-to-Text Ready (Phase 8)</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      if (currentScreen === 'opd_queue') {
        const today = new Date().toISOString().split('T')[0];
        const todayQueue = window.DB.opd_queue.filter(q => q.date === today).sort((a, b) => a.token_number - b.token_number);

        return `
          <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
              <h1 class="text-3xl font-bold">üé´ OPD Queue</h1>
              <div class="flex gap-3">
                <button onclick="showAddToQueueModal()" class="btn btn-success">+ Add</button>
                <button onclick="showQueueDisplay()" class="btn btn-info">üì∫ Display</button>
              </div>
            </div>

            <div class="space-y-4">
              ${todayQueue.length === 0 ? `
                <div class="card text-center py-12">
                  <div class="text-6xl mb-4">üé´</div>
                  <p class="text-xl text-gray-600">No patients in queue</p>
                  <button onclick="showAddToQueueModal()" class="btn btn-primary mt-4">Add First Patient</button>
                </div>
              ` : todayQueue.map(q => `
                <div class="card">
                  <div class="flex justify-between items-start">
                    <div class="flex gap-6 flex-1">
                      <div class="text-center">
                        <div class="text-5xl font-bold text-blue-600">${q.token_number}</div>
                      </div>
                      <div class="flex-1">
                        <h3 class="text-xl font-bold mb-2">${q.patient_name}</h3>
                        <div class="flex gap-3 mb-2">
                          <span class="badge ${q.status === 'priority' ? 'badge-danger' : q.status === 'waiting' ? 'badge-warning' : q.status === 'in_consultation' ? 'badge-primary' : 'badge-success'}">
                            ${q.status === 'priority' ? 'üö® PRIORITY' : q.status === 'waiting' ? '‚è≥ Waiting' : q.status === 'in_consultation' ? 'üë®‚Äç‚öïÔ∏è Consulting' : '‚úÖ Completed'}
                          </span>
                        </div>
                        <p class="text-gray-600 text-sm">üí¨ ${q.chief_complaint || 'No complaint'}</p>
                      </div>
                    </div>
                    <div class="flex gap-2">
                      ${q.status === 'waiting' ? `<button onclick="updateQueueStatus('${q.id}', 'in_consultation')" class="btn btn-primary">Start</button>` : ''}
                      ${q.status === 'in_consultation' ? `<button onclick="updateQueueStatus('${q.id}', 'completed')" class="btn btn-success">Complete</button>` : ''}
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (currentScreen === 'patients') {
        return `
          <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-8">üë• Patients</h1>
            <div class="space-y-4">
              ${window.DB.patients.map(p => `
                <div class="card">
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <h3 class="text-xl font-bold mb-2">${p.first_name} ${p.last_name || ''}</h3>
                      <div class="flex gap-3 mb-2">
                        <span class="badge badge-primary">${p.patient_id}</span>
                        <span class="text-gray-600">${p.age}Y ${p.gender}</span>
                      </div>
                    </div>
                    <div class="flex gap-3 flex-wrap">
                      <button onclick="showVitalSignsModal('${p.id}')" class="btn btn-info">ü©∫ Vitals</button>
                      <button onclick="showVitalTrendsModal('${p.id}')" class="btn btn-purple">üìä Trends</button>
                      <button onclick="showSOAPNotesModal('${p.id}')" class="btn btn-warning">üìã SOAP</button>
                      <button onclick="showLabOrderModal('${p.id}')" class="btn btn-success">üî¨ Lab</button>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (currentScreen === 'lab_orders') {
        return `
          <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-8">üî¨ Lab Orders</h1>
            <div class="space-y-4">
              ${window.DB.lab_orders.length === 0 ? `
                <div class="card text-center py-12">
                  <div class="text-6xl mb-4">üî¨</div>
                  <p class="text-xl text-gray-600">No lab orders yet</p>
                </div>
              ` : window.DB.lab_orders.map(order => {
                const patient = window.DB.patients.find(p => p.id === order.patient_id);
                return `
                  <div class="card">
                    <div class="flex justify-between items-start">
                      <div class="flex-1">
                        <h3 class="text-xl font-bold mb-2">${patient?.first_name} ${patient?.last_name || ''}</h3>
                        <p class="text-sm text-gray-600 mb-2">${order.tests.length} tests ‚Ä¢ ‚Çπ${order.total_amount}</p>
                        <div class="flex gap-2 flex-wrap">
                          ${order.tests.map(t => `<span class="badge badge-primary">${t.name}</span>`).join('')}
                        </div>
                      </div>
                      <div class="flex gap-2">
                        <span class="badge ${order.status === 'pending' ? 'badge-warning' : 'badge-success'}">
                          ${order.status === 'pending' ? '‚è≥ Pending' : '‚úÖ Completed'}
                        </span>
                        ${order.status === 'pending' ? `
                          <button onclick="showLabResultModal('${order.id}')" class="btn btn-primary">Enter Results</button>
                        ` : ''}
                      </div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }

      return `<div class="card"><h1 class="text-2xl font-bold mb-4">${currentScreen}</h1></div>`;
    }

    render();
  </script>
</body>
</html>