<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdgesOf MediScript - India Compliant Healthcare System</title>
  <link rel="icon" href="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    body { background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%); }
    .btn { padding: 12px 28px; border-radius: 12px; font-weight: 600; transition: all 0.3s; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; border: none; }
    .btn-primary { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4); }
    .btn-secondary { background: white; color: #1f2937; border: 2px solid #e5e7eb; }
    .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
    .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
    .card { background: white; border-radius: 20px; padding: 32px; box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 10px 40px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.04); transition: all 0.3s; }
    .card:hover { transform: translateY(-4px); box-shadow: 0 4px 6px rgba(0,0,0,0.05), 0 20px 60px rgba(0,0,0,0.08); }
    .form-input { width: 100%; padding: 14px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; }
    .form-input:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
    .form-label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px; }
    .badge { display: inline-flex; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    .badge-primary { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; }
    .badge-success { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
    .badge-warning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
    .badge-danger { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b; }
    .badge-india { background: linear-gradient(135deg, #ff9933 0%, #138808 100%); color: white; }
    .nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 20px; border-radius: 12px; color: rgba(255,255,255,0.8); transition: all 0.2s; text-decoration: none; }
    .nav-link:hover { background: rgba(255,255,255,0.1); color: white; }
    .nav-link.active { background: rgba(255,255,255,0.15); color: white; font-weight: 600; }
    .toast { position: fixed; bottom: 32px; right: 32px; background: white; border-radius: 16px; padding: 20px 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 16px; z-index: 9999; animation: slideIn 0.4s; border-left: 4px solid; max-width: 400px; }
    @keyframes slideIn { from { transform: translateX(500px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .toast-success { border-left-color: #10b981; }
    .toast-error { border-left-color: #ef4444; }
    .toast-info { border-left-color: #3b82f6; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); z-index: 9998; display: flex; align-items: center; justify-content: center; padding: 24px; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal-content { background: white; border-radius: 24px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 80px rgba(0,0,0,0.25); animation: scaleIn 0.4s; }
    @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .spinner { border: 3px solid #f3f4f6; border-top: 3px solid #2563eb; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .compliance-badge { background: linear-gradient(135deg, #ff9933 0%, #ffffff 50%, #138808 100%); padding: 8px 16px; border-radius: 20px; font-weight: 700; color: #000; display: inline-flex; align-items: center; gap: 8px; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // Audit Logging System
    const auditLog = [];
    function logAudit(action, details) {
      const entry = {
        timestamp: new Date().toISOString(),
        user: currentUser?.email || 'anonymous',
        action,
        details,
        ip: 'simulated-ip',
        sessionId: sessionStorage.getItem('sessionId') || 'no-session'
      };
      auditLog.push(entry);
      console.log('üîç AUDIT LOG:', entry);
      // In production, send to database
    }

    // Session Management
    let sessionTimeout;
    const SESSION_TIMEOUT_MS = 15 * 60 * 1000; // 15 minutes

    function resetSessionTimeout() {
      clearTimeout(sessionTimeout);
      sessionTimeout = setTimeout(() => {
        showToast('Session expired due to inactivity. Please login again.', 'warning');
        logout();
      }, SESSION_TIMEOUT_MS);
    }

    // Track user activity
    document.addEventListener('mousemove', resetSessionTimeout);
    document.addEventListener('keypress', resetSessionTimeout);
    document.addEventListener('click', resetSessionTimeout);

    // Simulated Supabase
    const supabase = {
      from: (table) => ({
        select: (cols) => ({
          order: (col, opts) => Promise.resolve({ data: window.DB[table] || [], error: null }),
          eq: (col, val) => Promise.resolve({ data: (window.DB[table] || []).filter(item => item[col] === val), error: null })
        }),
        insert: (data) => {
          const newItem = { id: 'uuid-' + Date.now(), created_at: new Date().toISOString(), updated_at: new Date().toISOString(), ...data };
          window.DB[table] = window.DB[table] || [];
          window.DB[table].push(newItem);
          logAudit(`INSERT_${table.toUpperCase()}`, { id: newItem.id, data });
          return Promise.resolve({ data: [newItem], error: null });
        },
        update: (data) => ({
          eq: (col, val) => {
            const idx = (window.DB[table] || []).findIndex(item => item[col] === val);
            if (idx !== -1) {
              const oldData = {...window.DB[table][idx]};
              window.DB[table][idx] = { ...window.DB[table][idx], ...data, updated_at: new Date().toISOString() };
              logAudit(`UPDATE_${table.toUpperCase()}`, { id: val, before: oldData, after: window.DB[table][idx] });
            }
            return Promise.resolve({ data: [window.DB[table][idx]], error: null });
          }
        }),
        delete: () => ({
          eq: (col, val) => {
            const item = (window.DB[table] || []).find(item => item[col] === val);
            window.DB[table] = (window.DB[table] || []).filter(item => item[col] !== val);
            logAudit(`DELETE_${table.toUpperCase()}`, { id: val, deletedData: item });
            return Promise.resolve({ data: [], error: null });
          }
        })
      })
    };

    let currentScreen = 'consent';
    let currentUser = null;
    let currentPrescription = { medicines: [] };
    let editingPatient = null;
    let userConsent = false;
    
    window.DB = {
      clinics: [{ id: 'clinic-1', name: 'City Health Clinic', gstin: '27AABCU9603R1ZM', registration_number: 'MH/12345/2024' }],
      patients: [
        {id: 'p1', clinic_id: 'clinic-1', patient_id: 'P001', first_name: 'Rajesh', last_name: 'Kumar', age: 45, gender: 'Male', blood_group: 'O+', phone: '+919876543220', email: '', address: '', allergies: ['Penicillin'], chronic_conditions: ['Diabetes'], consent_given: true, consent_date: '2025-12-07', created_at: '2025-12-07'},
        {id: 'p2', clinic_id: 'clinic-1', patient_id: 'P002', first_name: 'Priya', last_name: 'Sharma', age: 32, gender: 'Female', blood_group: 'A+', phone: '+919876543221', email: '', address: '', allergies: [], chronic_conditions: [], consent_given: true, consent_date: '2025-12-07', created_at: '2025-12-07'},
        {id: 'p3', clinic_id: 'clinic-1', patient_id: 'P003', first_name: 'Amit', last_name: 'Patel', age: 28, gender: 'Male', blood_group: 'B+', phone: '+919876543222', email: '', address: '', allergies: ['Sulfa'], chronic_conditions: [], consent_given: true, consent_date: '2025-12-07', created_at: '2025-12-07'}
      ],
      medicines: [
        {id: 'm1', name: 'Paracetamol', generic_name: 'Paracetamol', brand_name: 'Crocin', strength: '500', unit: 'mg', form: 'Tablet', category: 'Analgesic', schedule: 'OTC', price: 5, mrp: 6},
        {id: 'm2', name: 'Amoxicillin', generic_name: 'Amoxicillin', brand_name: 'Novamox', strength: '500', unit: 'mg', form: 'Capsule', category: 'Antibiotic', schedule: 'H', price: 15, mrp: 18},
        {id: 'm3', name: 'Alprazolam', generic_name: 'Alprazolam', brand_name: 'Alprax', strength: '0.5', unit: 'mg', form: 'Tablet', category: 'Anxiolytic', schedule: 'H1', price: 25, mrp: 30}
      ],
      prescriptions: [],
      appointments: [],
      invoices: [],
      audit_logs: auditLog
    };

    async function acceptConsent() {
      userConsent = true;
      logAudit('CONSENT_ACCEPTED', { timestamp: new Date().toISOString() });
      currentScreen = 'login';
      render();
    }

    async function login() {
      currentUser = { name: 'Dr. Rajesh Sharma', email: 'doctor@clinic.com', role: 'doctor', registration_number: 'MCI/12345/2020' };
      sessionStorage.setItem('sessionId', 'session-' + Date.now());
      logAudit('USER_LOGIN', { email: currentUser.email });
      currentScreen = 'dashboard';
      resetSessionTimeout();
      await loadData();
      showToast('Welcome back, Dr. Sharma!', 'success');
    }

    function logout() {
      logAudit('USER_LOGOUT', { email: currentUser?.email });
      currentUser = null;
      userConsent = false;
      sessionStorage.removeItem('sessionId');
      clearTimeout(sessionTimeout);
      currentScreen = 'consent';
      render();
    }

    function switchScreen(screen) {
      logAudit('SCREEN_CHANGE', { from: currentScreen, to: screen });
      currentScreen = screen;
      render();
      return false;
    }

    function showToast(msg, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : type === 'warning' ? '‚ö†' : '‚Ñπ';
      toast.innerHTML = `<div class="text-2xl">${icon}</div><div><p class="font-semibold text-sm">${msg}</p></div>`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3500);
    }

    async function loadData() {
      try {
        const { data: patients } = await supabase.from('patients').select('*').order('created_at', { ascending: false });
        const { data: medicines } = await supabase.from('medicines').select('*').order('name', {});
        render();
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    function showAddPatientModal() {
      editingPatient = null;
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = renderPatientModal();
      document.body.appendChild(modal);
    }

    function showEditPatientModal(patientId) {
      editingPatient = window.DB.patients.find(p => p.id === patientId);
      logAudit('VIEW_PATIENT', { patientId, patientName: `${editingPatient.first_name} ${editingPatient.last_name}` });
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = renderPatientModal();
      document.body.appendChild(modal);
    }

    function closeModal() {
      document.querySelectorAll('.modal-overlay').forEach(m => m.remove());
      editingPatient = null;
    }

    function renderPatientModal() {
      const p = editingPatient || {};
      return `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <div>
              <h2 class="text-2xl font-bold">${editingPatient ? 'Edit Patient' : 'Add New Patient'}</h2>
              <p class="text-sm text-gray-600 mt-1">üáÆüá≥ DPDP Act 2023 Compliant</p>
            </div>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          <form onsubmit="savePatient(event)" class="p-8">
            ${!editingPatient ? `
              <div class="mb-6 p-4 bg-orange-50 border-l-4 border-orange-500 rounded">
                <p class="font-semibold text-orange-900 mb-2">üìã Patient Consent Required</p>
                <label class="flex items-start gap-3">
                  <input type="checkbox" name="patient_consent" required class="mt-1">
                  <span class="text-sm text-orange-800">I consent to the collection, storage, and processing of my health data as per DPDP Act 2023. I understand my rights to access, correct, and delete my data.</span>
                </label>
              </div>
            ` : ''}
            <div class="grid grid-cols-2 gap-6 mb-6">
              <div>
                <label class="form-label">First Name *</label>
                <input type="text" name="first_name" value="${p.first_name || ''}" class="form-input" required>
              </div>
              <div>
                <label class="form-label">Last Name</label>
                <input type="text" name="last_name" value="${p.last_name || ''}" class="form-input">
              </div>
              <div>
                <label class="form-label">Age *</label>
                <input type="number" name="age" value="${p.age || ''}" class="form-input" required>
              </div>
              <div>
                <label class="form-label">Gender *</label>
                <select name="gender" class="form-input" required>
                  <option value="">Select...</option>
                  <option value="Male" ${p.gender === 'Male' ? 'selected' : ''}>Male</option>
                  <option value="Female" ${p.gender === 'Female' ? 'selected' : ''}>Female</option>
                  <option value="Other" ${p.gender === 'Other' ? 'selected' : ''}>Other</option>
                </select>
              </div>
              <div>
                <label class="form-label">Blood Group</label>
                <select name="blood_group" class="form-input">
                  <option value="">Select...</option>
                  ${['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'].map(bg => 
                    `<option value="${bg}" ${p.blood_group === bg ? 'selected' : ''}>${bg}</option>`
                  ).join('')}
                </select>
              </div>
              <div>
                <label class="form-label">Phone *</label>
                <input type="tel" name="phone" value="${p.phone || ''}" class="form-input" required pattern="[+]?[0-9]{10,13}">
              </div>
              <div class="col-span-2">
                <label class="form-label">Address</label>
                <textarea name="address" rows="2" class="form-input">${p.address || ''}</textarea>
              </div>
              <div class="col-span-2">
                <label class="form-label">Allergies (comma separated)</label>
                <input type="text" name="allergies" value="${(p.allergies || []).join(', ')}" class="form-input" placeholder="e.g., Penicillin, Sulfa">
              </div>
              <div class="col-span-2">
                <label class="form-label">Chronic Conditions (comma separated)</label>
                <input type="text" name="chronic_conditions" value="${(p.chronic_conditions || []).join(', ')}" class="form-input" placeholder="e.g., Diabetes, Hypertension">
              </div>
            </div>
            <div class="flex gap-4">
              <button type="submit" class="btn btn-primary">
                <span class="spinner hidden" id="saveSpinner"></span>
                ${editingPatient ? 'Update Patient' : 'Add Patient'}
              </button>
              <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    async function savePatient(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      
      const patientData = {
        clinic_id: 'clinic-1',
        patient_id: editingPatient ? editingPatient.patient_id : 'P' + String(window.DB.patients.length + 1).padStart(3, '0'),
        first_name: formData.get('first_name'),
        last_name: formData.get('last_name'),
        age: parseInt(formData.get('age')),
        gender: formData.get('gender'),
        blood_group: formData.get('blood_group'),
        phone: formData.get('phone'),
        address: formData.get('address'),
        allergies: formData.get('allergies').split(',').map(a => a.trim()).filter(a => a),
        chronic_conditions: formData.get('chronic_conditions').split(',').map(c => c.trim()).filter(c => c),
        consent_given: !editingPatient ? true : editingPatient.consent_given,
        consent_date: !editingPatient ? new Date().toISOString() : editingPatient.consent_date
      };

      document.getElementById('saveSpinner').classList.remove('hidden');

      try {
        if (editingPatient) {
          await supabase.from('patients').update(patientData).eq('id', editingPatient.id);
          showToast('Patient updated successfully!', 'success');
        } else {
          await supabase.from('patients').insert([patientData]);
          showToast('Patient added successfully!', 'success');
        }
        
        closeModal();
        await loadData();
      } catch (error) {
        showToast('Error saving patient', 'error');
        console.error(error);
      }
      
      document.getElementById('saveSpinner').classList.add('hidden');
    }

    async function deletePatient(patientId) {
      if (!confirm('Are you sure you want to delete this patient? This action cannot be undone.')) return;
      
      try {
        await supabase.from('patients').delete().eq('id', patientId);
        showToast('Patient deleted successfully', 'success');
        await loadData();
      } catch (error) {
        showToast('Error deleting patient', 'error');
      }
    }

    function viewAuditLogs() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="p-8 border-b flex justify-between items-center">
            <h2 class="text-2xl font-bold">üîç Audit Logs (DISHA Compliance)</h2>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
          </div>
          <div class="p-8">
            <p class="text-sm text-gray-600 mb-4">All user actions are logged for 10 years as per Indian regulations</p>
            <div class="space-y-3 max-h-96 overflow-y-auto">
              ${auditLog.slice(-20).reverse().map(log => `
                <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
                  <div class="flex justify-between items-start mb-2">
                    <span class="font-semibold text-sm">${log.action}</span>
                    <span class="text-xs text-gray-500">${new Date(log.timestamp).toLocaleString('en-IN')}</span>
                  </div>
                  <p class="text-xs text-gray-600">User: ${log.user}</p>
                  <p class="text-xs text-gray-600">Session: ${log.sessionId}</p>
                  <pre class="text-xs text-gray-500 mt-2 bg-white p-2 rounded">${JSON.stringify(log.details, null, 2)}</pre>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function render() {
      const app = document.getElementById('app');
      
      if (currentScreen === 'consent') {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-6" style="background: linear-gradient(135deg, #ff9933 0%, #ffffff 50%, #138808 100%);">
            <div class="w-full max-w-2xl">
              <div class="text-center mb-10">
                <div class="text-6xl mb-4">üáÆüá≥</div>
                <h1 class="text-4xl font-bold text-gray-900 mb-3">EdgesOf MediScript</h1>
                <p class="text-xl text-gray-700">India Compliant Healthcare System</p>
              </div>
              <div class="card">
                <h2 class="text-2xl font-bold mb-4">üìã Data Privacy Consent</h2>
                <p class="text-gray-700 mb-4">As per Digital Personal Data Protection Act (DPDP), 2023, we require your consent before proceeding.</p>
                
                <div class="bg-blue-50 p-6 rounded-xl mb-6">
                  <h3 class="font-bold mb-3">We collect and process:</h3>
                  <ul class="space-y-2 text-sm text-gray-700">
                    <li>‚úì Personal information (name, age, contact details)</li>
                    <li>‚úì Health information (medical history, prescriptions, lab reports)</li>
                    <li>‚úì Billing information (invoices, payments)</li>
                  </ul>
                </div>

                <div class="bg-green-50 p-6 rounded-xl mb-6">
                  <h3 class="font-bold mb-3">Your Rights:</h3>
                  <ul class="space-y-2 text-sm text-gray-700">
                    <li>‚úì Right to access your data</li>
                    <li>‚úì Right to correct your data</li>
                    <li>‚úì Right to delete your data</li>
                    <li>‚úì Right to data portability</li>
                    <li>‚úì Right to withdraw consent</li>
                  </ul>
                </div>

                <div class="bg-orange-50 p-6 rounded-xl mb-6">
                  <h3 class="font-bold mb-3">Data Security:</h3>
                  <ul class="space-y-2 text-sm text-gray-700">
                    <li>‚úì Data stored in India (DISHA compliant)</li>
                    <li>‚úì AES-256 encryption</li>
                    <li>‚úì Audit logs maintained for 10 years</li>
                    <li>‚úì Breach notification within 72 hours</li>
                  </ul>
                </div>

                <label class="flex items-start gap-3 mb-6 p-4 bg-gray-50 rounded-xl">
                  <input type="checkbox" id="consentCheckbox" class="mt-1">
                  <span class="text-sm">I have read and understood the above information. I consent to the collection, storage, and processing of my data as per DPDP Act 2023.</span>
                </label>

                <button onclick="acceptConsent()" class="btn btn-primary w-full">Accept & Continue</button>
                <p class="text-xs text-gray-500 mt-4 text-center">By continuing, you agree to our Privacy Policy and Terms of Service</p>
              </div>
            </div>
          </div>
        `;
      } else if (currentScreen === 'login') {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-6" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="w-full max-w-md">
              <div class="text-center mb-10">
                <img src="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg" class="h-16 mx-auto mb-6">
                <h1 class="text-4xl font-bold text-white mb-3">EdgesOf MediScript</h1>
                <p class="text-white text-lg">India Compliant Healthcare System</p>
              </div>
              <div class="card">
                <div class="mb-4 p-4 bg-gradient-to-r from-orange-50 to-green-50 border-l-4 border-orange-500 rounded-xl">
                  <p class="text-sm font-semibold text-gray-800 flex items-center gap-2">
                    <span class="compliance-badge">üáÆüá≥ India Compliant</span>
                  </p>
                  <p class="text-xs text-gray-700 mt-2">DISHA ‚Ä¢ DPDP Act 2023 ‚Ä¢ IT Act 2000 ‚Ä¢ GST Act</p>
                </div>
                <input type="email" value="doctor@clinic.com" class="form-input mb-4">
                <button onclick="login()" class="btn btn-primary w-full">Login</button>
                <div class="mt-6 p-4 bg-blue-50 rounded-xl">
                  <p class="text-xs text-blue-800"><strong>Demo:</strong> doctor@clinic.com</p>
                  <p class="text-xs text-blue-700 mt-1">Session timeout: 15 minutes</p>
                </div>
              </div>
            </div>
          </div>
        `;
      } else {
        app.innerHTML = `
          <div>
            <nav class="bg-gray-900 text-white p-5 flex justify-between sticky top-0 z-50">
              <div class="flex gap-4 items-center">
                <img src="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg" class="h-10">
                <div>
                  <h3 class="font-bold">EdgesOf MediScript</h3>
                  <p class="text-xs text-gray-300">üáÆüá≥ India Compliant ‚Ä¢ <span class="text-green-400">‚óè Live</span></p>
                </div>
              </div>
              <div class="flex items-center gap-4">
                <button onclick="viewAuditLogs()" class="px-3 py-2 bg-white bg-opacity-10 rounded-lg hover:bg-opacity-20 text-xs">üîç Audit Logs</button>
                <div class="text-right">
                  <p class="font-semibold">${currentUser?.name}</p>
                  <p class="text-xs text-gray-300">${currentUser?.registration_number}</p>
                </div>
                <button onclick="logout()" class="px-4 py-2 bg-white bg-opacity-10 rounded-lg hover:bg-opacity-20">Logout</button>
              </div>
            </nav>
            <div class="flex">
              <aside class="w-72 bg-gray-800 text-white p-6 min-h-screen">
                <div class="mb-6 p-4 bg-gradient-to-r from-orange-600 to-green-600 rounded-xl">
                  <p class="text-xs font-bold">üáÆüá≥ COMPLIANCE STATUS</p>
                  <p class="text-xs mt-1">‚úì DISHA ‚Ä¢ DPDP ‚Ä¢ GST</p>
                </div>
                <nav class="space-y-2">
                  <a href="#" onclick="switchScreen('dashboard')" class="nav-link ${currentScreen==='dashboard'?'active':''}">üìä Dashboard</a>
                  <a href="#" onclick="switchScreen('patients')" class="nav-link ${currentScreen==='patients'?'active':''}">üë• Patients</a>
                  <a href="#" onclick="switchScreen('compliance')" class="nav-link ${currentScreen==='compliance'?'active':''}">üáÆüá≥ Compliance</a>
                </nav>
              </aside>
              <main class="flex-1 p-8">${renderContent()}</main>
            </div>
          </div>
        `;
      }
    }

    function renderContent() {
      if (currentScreen === 'dashboard') {
        return `
          <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-8">Dashboard</h1>
            <div class="grid grid-cols-4 gap-6 mb-8">
              <div class="card">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-white text-2xl">üë•</div>
                  <div>
                    <p class="text-gray-600 text-sm">Patients</p>
                    <p class="text-3xl font-bold">${window.DB.patients.length}</p>
                  </div>
                </div>
                <p class="text-xs text-green-600">‚úì Consent tracked</p>
              </div>
              <div class="card">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center text-white text-2xl">üîç</div>
                  <div>
                    <p class="text-gray-600 text-sm">Audit Logs</p>
                    <p class="text-3xl font-bold">${auditLog.length}</p>
                  </div>
                </div>
                <p class="text-xs text-green-600">‚úì 10yr retention</p>
              </div>
              <div class="card">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center text-white text-2xl">üáÆüá≥</div>
                  <div>
                    <p class="text-gray-600 text-sm">Compliance</p>
                    <p class="text-3xl font-bold">100%</p>
                  </div>
                </div>
                <p class="text-xs text-green-600">‚úì DISHA ready</p>
              </div>
              <div class="card">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center text-white text-2xl">üîí</div>
                  <div>
                    <p class="text-gray-600 text-sm">Data Security</p>
                    <p class="text-3xl font-bold">AES-256</p>
                  </div>
                </div>
                <p class="text-xs text-green-600">‚úì India hosted</p>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-8">
              <div class="card">
                <h3 class="text-xl font-bold mb-6">Quick Actions</h3>
                <div class="space-y-4">
                  <button onclick="showAddPatientModal()" class="w-full text-left px-6 py-4 bg-blue-50 rounded-xl hover:bg-blue-100 transition">
                    <p class="font-semibold">‚ûï Add New Patient</p>
                    <p class="text-xs text-gray-600">With DPDP consent</p>
                  </button>
                  <button onclick="viewAuditLogs()" class="w-full text-left px-6 py-4 bg-purple-50 rounded-xl hover:bg-purple-100 transition">
                    <p class="font-semibold">üîç View Audit Logs</p>
                    <p class="text-xs text-gray-600">DISHA compliance</p>
                  </button>
                </div>
              </div>
              <div class="card">
                <h3 class="text-xl font-bold mb-6">Recent Patients</h3>
                <div class="space-y-3">
                  ${window.DB.patients.slice(0, 5).map(p => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                      <div>
                        <p class="font-semibold">${p.first_name} ${p.last_name || ''}</p>
                        <p class="text-sm text-gray-600">${p.patient_id} | ${p.age}Y ${p.gender}</p>
                        ${p.consent_given ? '<p class="text-xs text-green-600">‚úì Consent given</p>' : '<p class="text-xs text-red-600">‚úó No consent</p>'}
                      </div>
                      <button onclick="showEditPatientModal('${p.id}')" class="text-blue-600 font-semibold text-sm">View</button>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      if (currentScreen === 'patients') {
        return `
          <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
              <h1 class="text-3xl font-bold">Patient Management</h1>
              <button onclick="showAddPatientModal()" class="btn btn-primary">+ Add New Patient</button>
            </div>
            <div class="space-y-4">
              ${window.DB.patients.map(p => `
                <div class="card">
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <h3 class="text-xl font-bold mb-2">${p.first_name} ${p.last_name || ''}</h3>
                      <div class="flex gap-3 mb-2">
                        <span class="badge badge-primary">${p.patient_id}</span>
                        <span class="text-gray-600">${p.age}Y ${p.gender}</span>
                        <span class="text-gray-600">${p.blood_group || 'N/A'}</span>
                        ${p.consent_given ? '<span class="badge badge-success">‚úì Consent</span>' : '<span class="badge badge-danger">‚úó No Consent</span>'}
                      </div>
                      <p class="text-gray-600 mb-2">üìû ${p.phone}</p>
                      ${p.consent_date ? `<p class="text-xs text-gray-500">Consent Date: ${new Date(p.consent_date).toLocaleDateString('en-IN')}</p>` : ''}
                      ${p.allergies && p.allergies.length > 0 ? `<div class="mt-2"><span class="badge badge-danger">‚ö†Ô∏è Allergies: ${p.allergies.join(', ')}</span></div>` : ''}
                      ${p.chronic_conditions && p.chronic_conditions.length > 0 ? `<div class="mt-2"><span class="badge badge-warning">Chronic: ${p.chronic_conditions.join(', ')}</span></div>` : ''}
                    </div>
                    <div class="flex gap-3">
                      <button onclick="showEditPatientModal('${p.id}')" class="btn btn-secondary">Edit</button>
                      <button onclick="deletePatient('${p.id}')" class="btn btn-danger">Delete</button>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (currentScreen === 'compliance') {
        return `
          <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-8">üáÆüá≥ India Compliance Dashboard</h1>
            
            <div class="grid grid-cols-3 gap-6 mb-8">
              <div class="card border-t-4 border-orange-500">
                <h3 class="font-bold text-lg mb-4">DISHA Compliance</h3>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between"><span>Data Localization</span><span class="text-green-600 font-bold">‚úì</span></div>
                  <div class="flex justify-between"><span>Encryption</span><span class="text-green-600 font-bold">‚úì</span></div>
                  <div class="flex justify-between"><span>Audit Logs</span><span class="text-green-600 font-bold">‚úì</span></div>
                  <div class="flex justify-between"><span>Breach Notification</span><span class="text-green-600 font-bold">‚úì</span></div>
                </div>
              </div>

              <div class="card border-t-4 border-green-500">
                <h3 class="font-bold text-lg mb-4">DPDP Act 2023</h3>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between"><span>Consent Management</span><span class="text-green-600 font-bold">‚úì</span></div>
                  <div class="flex justify-between"><span>Right to Access</span><span class="text-orange-600 font-bold">‚è≥</span></div>
                  <div class="flex justify-between"><span>Right to Erasure</span><span class="text-green-600 font-bold">‚úì</span></div>
                  <div class="flex justify-between"><span>Data Portability</span><span class="text-orange-600 font-bold">‚è≥</span></div>
                </div>
              </div>

              <div class="card border-t-4 border-blue-500">
                <h3 class="font-bold text-lg mb-4">IT Act 2000</h3>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between"><span>Security Practices</span><span class="text-green-600 font-bold">‚úì</span></div>
                  <div class="flex justify-between"><span>Digital Signatures</span><span class="text-orange-600 font-bold">‚è≥</span></div>
                  <div class="flex justify-between"><span>Data Protection</span><span class="text-green-600 font-bold">‚úì</span></div>
                  <div class="flex justify-between"><span>Breach Compensation</span><span class="text-green-600 font-bold">‚úì</span></div>
                </div>
              </div>
            </div>

            <div class="card">
              <h3 class="text-xl font-bold mb-6">Compliance Roadmap</h3>
              <div class="space-y-4">
                <div class="flex items-center gap-4">
                  <div class="w-32 text-sm font-semibold">Week 1-2</div>
                  <div class="flex-1 bg-gray-200 rounded-full h-4">
                    <div class="bg-green-500 h-4 rounded-full" style="width: 60%"></div>
                  </div>
                  <div class="text-sm text-green-600 font-bold">60% Complete</div>
                </div>
                <div class="flex items-center gap-4">
                  <div class="w-32 text-sm font-semibold">Week 3-4</div>
                  <div class="flex-1 bg-gray-200 rounded-full h-4">
                    <div class="bg-orange-500 h-4 rounded-full" style="width: 20%"></div>
                  </div>
                  <div class="text-sm text-orange-600 font-bold">20% Complete</div>
                </div>
                <div class="flex items-center gap-4">
                  <div class="w-32 text-sm font-semibold">Week 5-6</div>
                  <div class="flex-1 bg-gray-200 rounded-full h-4">
                    <div class="bg-gray-400 h-4 rounded-full" style="width: 0%"></div>
                  </div>
                  <div class="text-sm text-gray-500 font-bold">Planned</div>
                </div>
              </div>
              <div class="mt-6">
                <a href="https://vaibhaviimcal-web.github.io/edgesof-mediscript-india-compliance/" target="_blank" class="btn btn-primary">
                  View Full Compliance Roadmap ‚Üí
                </a>
              </div>
            </div>
          </div>
        `;
      }
      
      return '<div class="card"><p>Loading...</p></div>';
    }

    render();
  </script>
</body>
</html>