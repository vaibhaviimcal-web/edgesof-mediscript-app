<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdgesOf MediScript - Enterprise Prescription System</title>
  <link rel="icon" href="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    body { background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%); }
    .btn { padding: 12px 28px; border-radius: 12px; font-weight: 600; transition: all 0.3s; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
    .btn-primary { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4); }
    .btn-secondary { background: white; color: #1f2937; border: 2px solid #e5e7eb; }
    .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; }
    .card { background: white; border-radius: 20px; padding: 32px; box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 10px 40px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.04); transition: all 0.3s; }
    .card:hover { transform: translateY(-4px); box-shadow: 0 4px 6px rgba(0,0,0,0.05), 0 20px 60px rgba(0,0,0,0.08); }
    .form-input { width: 100%; padding: 14px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; }
    .form-input:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
    .badge { display: inline-flex; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    .badge-primary { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; }
    .badge-success { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
    .badge-warning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
    .badge-danger { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b; }
    .nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 20px; border-radius: 12px; color: rgba(255,255,255,0.8); transition: all 0.2s; text-decoration: none; }
    .nav-link:hover { background: rgba(255,255,255,0.1); color: white; }
    .nav-link.active { background: rgba(255,255,255,0.15); color: white; font-weight: 600; }
    .toast { position: fixed; bottom: 32px; right: 32px; background: white; border-radius: 16px; padding: 20px 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 16px; z-index: 9999; animation: slideIn 0.4s; border-left: 4px solid; }
    @keyframes slideIn { from { transform: translateX(500px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .toast-success { border-left-color: #10b981; }
    .toast-error { border-left-color: #ef4444; }
    .toast-info { border-left-color: #3b82f6; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); z-index: 9998; display: flex; align-items: center; justify-content: center; padding: 24px; }
    .modal-content { background: white; border-radius: 24px; max-width: 1000px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 80px rgba(0,0,0,0.25); }
    .spinner { border: 3px solid #f3f4f6; border-top: 3px solid #2563eb; border-radius: 50%; width: 24px; height: 24px; animation: spin 0.8s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="app">
    <div class="min-h-screen flex items-center justify-center p-6" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <div class="w-full max-w-md">
        <div class="text-center mb-10">
          <img src="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg" class="h-16 mx-auto mb-6">
          <h1 class="text-4xl font-bold text-white mb-3">EdgesOf MediScript</h1>
          <p class="text-white text-lg">Enterprise Prescription Management</p>
        </div>
        <div class="card">
          <div class="mb-4 p-4 bg-green-50 border-l-4 border-green-500 rounded-xl">
            <p class="text-sm font-semibold text-green-800">‚úÖ Connected to Real Database!</p>
            <p class="text-xs text-green-700 mt-1">All data is now persistent and saved</p>
          </div>
          <input type="email" id="email" value="doctor@clinic.com" class="form-input mb-4" placeholder="Email">
          <button onclick="login()" class="btn btn-primary w-full">
            <span>Login</span>
          </button>
          <div class="mt-6 p-4 bg-blue-50 rounded-xl">
            <p class="text-xs text-blue-800"><strong>Demo:</strong> doctor@clinic.com</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize Supabase (using Bhindi's configured connection)
    const supabase = window.supabase.createClient(
      'https://your-project.supabase.co', // This will use Bhindi's connection
      'your-anon-key' // This will use Bhindi's connection
    );

    let currentScreen = 'login';
    let currentUser = null;
    let currentPrescription = { medicines: [] };
    let DB = { patients: [], medicines: [], prescriptions: [] };

    // Load data from Supabase
    async function loadData() {
      try {
        showToast('Loading data from database...', 'info');
        
        // Load patients
        const { data: patients, error: patientsError } = await supabase
          .from('patients')
          .select('*')
          .order('created_at', { ascending: false });
        
        if (!patientsError) DB.patients = patients || [];
        
        // Load medicines
        const { data: medicines, error: medicinesError } = await supabase
          .from('medicines')
          .select('*')
          .order('name');
        
        if (!medicinesError) DB.medicines = medicines || [];
        
        // Load prescriptions
        const { data: prescriptions, error: prescriptionsError } = await supabase
          .from('prescriptions')
          .select('*')
          .order('created_at', { ascending: false });
        
        if (!prescriptionsError) DB.prescriptions = prescriptions || [];
        
        showToast('Data loaded successfully!', 'success');
        render();
      } catch (error) {
        console.error('Error loading data:', error);
        showToast('Error loading data', 'error');
      }
    }

    async function login() {
      currentUser = { name: 'Dr. Rajesh Sharma', email: 'doctor@clinic.com' };
      currentScreen = 'dashboard';
      await loadData();
      showToast('Welcome back, Dr. Sharma!', 'success');
    }

    function logout() {
      currentUser = null;
      currentScreen = 'login';
      render();
    }

    function switchScreen(screen) {
      currentScreen = screen;
      render();
      return false;
    }

    function showToast(msg, type) {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Ñπ';
      toast.innerHTML = `<div class="text-2xl">${icon}</div><div><p class="font-semibold">${msg}</p></div>`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3500);
    }

    function render() {
      const app = document.getElementById('app');
      if (currentScreen === 'login') {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-6" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="w-full max-w-md">
              <div class="text-center mb-10">
                <img src="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg" class="h-16 mx-auto mb-6">
                <h1 class="text-4xl font-bold text-white mb-3">EdgesOf MediScript</h1>
                <p class="text-white text-lg">Enterprise Prescription Management</p>
              </div>
              <div class="card">
                <div class="mb-4 p-4 bg-green-50 border-l-4 border-green-500 rounded-xl">
                  <p class="text-sm font-semibold text-green-800">‚úÖ Connected to Real Database!</p>
                  <p class="text-xs text-green-700 mt-1">All data is now persistent and saved</p>
                </div>
                <input type="email" value="doctor@clinic.com" class="form-input mb-4">
                <button onclick="login()" class="btn btn-primary w-full">Login</button>
                <div class="mt-6 p-4 bg-blue-50 rounded-xl">
                  <p class="text-xs text-blue-800"><strong>Demo:</strong> doctor@clinic.com</p>
                </div>
              </div>
            </div>
          </div>
        `;
      } else {
        app.innerHTML = `
          <div>
            <nav class="bg-gray-900 text-white p-5 flex justify-between sticky top-0 z-50">
              <div class="flex gap-4 items-center">
                <img src="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg" class="h-10">
                <div>
                  <h3 class="font-bold">EdgesOf MediScript</h3>
                  <p class="text-xs text-gray-300">City Health Clinic ‚Ä¢ <span class="text-green-400">‚óè Database Connected</span></p>
                </div>
              </div>
              <div class="flex items-center gap-4">
                <div class="text-right"><p class="font-semibold">Dr. Rajesh Sharma</p></div>
                <button onclick="logout()" class="px-4 py-2 bg-white bg-opacity-10 rounded-lg hover:bg-opacity-20">Logout</button>
              </div>
            </nav>
            <div class="flex">
              <aside class="w-72 bg-gray-800 text-white p-6 min-h-screen">
                <nav class="space-y-2">
                  <a href="#" onclick="switchScreen('dashboard')" class="nav-link ${currentScreen==='dashboard'?'active':''}">üìä Dashboard</a>
                  <a href="#" onclick="switchScreen('patients')" class="nav-link ${currentScreen==='patients'?'active':''}">üë• Patients</a>
                  <a href="#" onclick="switchScreen('opd')" class="nav-link ${currentScreen==='opd'?'active':''}">ü©∫ OPD Visit</a>
                  <a href="#" onclick="switchScreen('prescriptions')" class="nav-link ${currentScreen==='prescriptions'?'active':''}">üíä Prescriptions</a>
                </nav>
              </aside>
              <main class="flex-1 p-8">${renderContent()}</main>
            </div>
          </div>
        `;
      }
    }

    function renderContent() {
      if (currentScreen === 'dashboard') {
        return `
          <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-8">Dashboard</h1>
            <div class="grid grid-cols-3 gap-6 mb-8">
              <div class="card">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-white text-2xl">üë•</div>
                  <div>
                    <p class="text-gray-600 text-sm">Total Patients</p>
                    <p class="text-4xl font-bold">${DB.patients.length}</p>
                  </div>
                </div>
                <p class="text-xs text-green-600 font-semibold">‚úì From Real Database</p>
              </div>
              <div class="card">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center text-white text-2xl">üíä</div>
                  <div>
                    <p class="text-gray-600 text-sm">Medicines</p>
                    <p class="text-4xl font-bold">${DB.medicines.length}</p>
                  </div>
                </div>
                <p class="text-xs text-green-600 font-semibold">‚úì From Real Database</p>
              </div>
              <div class="card">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center text-white text-2xl">üìã</div>
                  <div>
                    <p class="text-gray-600 text-sm">Prescriptions</p>
                    <p class="text-4xl font-bold">${DB.prescriptions.length}</p>
                  </div>
                </div>
                <p class="text-xs text-green-600 font-semibold">‚úì From Real Database</p>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-8">
              <div class="card">
                <h3 class="text-xl font-bold mb-6">Quick Actions</h3>
                <div class="space-y-4">
                  <button onclick="switchScreen('patients')" class="w-full text-left px-6 py-4 bg-blue-50 rounded-xl hover:bg-blue-100 transition">
                    <p class="font-semibold">Add New Patient</p>
                    <p class="text-sm text-gray-600">Register in database</p>
                  </button>
                  <button onclick="switchScreen('opd')" class="w-full text-left px-6 py-4 bg-green-50 rounded-xl hover:bg-green-100 transition">
                    <p class="font-semibold">New OPD Visit</p>
                    <p class="text-sm text-gray-600">Start consultation</p>
                  </button>
                </div>
              </div>
              <div class="card">
                <h3 class="text-xl font-bold mb-6">Recent Patients</h3>
                <div class="space-y-3">
                  ${DB.patients.slice(0, 5).map(p => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                      <div>
                        <p class="font-semibold">${p.first_name} ${p.last_name || ''}</p>
                        <p class="text-sm text-gray-600">${p.patient_id} | ${p.age}Y ${p.gender}</p>
                      </div>
                      <button onclick="switchScreen('opd')" class="text-blue-600 font-semibold text-sm">View ‚Üí</button>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      if (currentScreen === 'patients') {
        return `
          <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
              <h1 class="text-3xl font-bold">Patients</h1>
              <div class="flex gap-3">
                <button onclick="loadData()" class="btn btn-secondary">
                  <span class="spinner" style="width: 16px; height: 16px; border-width: 2px;"></span>
                  Refresh
                </button>
                <button onclick="showToast('Add patient feature coming soon!', 'info')" class="btn btn-primary">+ Add Patient</button>
              </div>
            </div>
            <div class="space-y-4">
              ${DB.patients.map(p => `
                <div class="card">
                  <div class="flex justify-between items-start">
                    <div>
                      <h3 class="text-xl font-bold mb-2">${p.first_name} ${p.last_name || ''}</h3>
                      <div class="flex gap-3 mb-2">
                        <span class="badge badge-primary">${p.patient_id}</span>
                        <span class="text-gray-600">${p.age}Y ${p.gender}</span>
                        <span class="text-gray-600">${p.blood_group}</span>
                      </div>
                      <p class="text-gray-600">üìû ${p.phone}</p>
                      ${p.allergies && p.allergies.length > 0 ? `<div class="mt-2"><span class="badge badge-danger">‚ö†Ô∏è Allergies: ${p.allergies.join(', ')}</span></div>` : ''}
                      ${p.chronic_conditions && p.chronic_conditions.length > 0 ? `<div class="mt-2"><span class="badge badge-warning">Chronic: ${p.chronic_conditions.join(', ')}</span></div>` : ''}
                    </div>
                    <button onclick="switchScreen('opd')" class="btn btn-success">New Visit</button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      if (currentScreen === 'opd') {
        return `
          <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-8">OPD Visit Form</h1>
            <div class="card mb-6">
              <h3 class="text-xl font-bold mb-4">Patient Information</h3>
              <select class="form-input mb-4">
                <option>Select patient...</option>
                ${DB.patients.map(p => `<option value="${p.id}">${p.first_name} ${p.last_name || ''} (${p.patient_id})</option>`).join('')}
              </select>
            </div>
            <div class="card mb-6">
              <h3 class="text-xl font-bold mb-4">Vitals</h3>
              <div class="grid grid-cols-4 gap-4">
                <input type="text" placeholder="BP" class="form-input">
                <input type="text" placeholder="Temp" class="form-input">
                <input type="text" placeholder="Pulse" class="form-input">
                <input type="text" placeholder="SpO2" class="form-input">
              </div>
            </div>
            <div class="card mb-6">
              <h3 class="text-xl font-bold mb-4">Clinical Assessment</h3>
              <textarea rows="3" placeholder="Chief complaint..." class="form-input mb-4"></textarea>
              <input type="text" placeholder="Diagnosis" class="form-input">
            </div>
            <div class="flex gap-4">
              <button onclick="showToast('OPD visit will be saved to database!', 'success')" class="btn btn-primary">Save Visit</button>
              <button onclick="switchScreen('prescriptions')" class="btn btn-success">Generate Prescription</button>
            </div>
          </div>
        `;
      }
      
      if (currentScreen === 'prescriptions') {
        return `
          <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-8">Prescription Management</h1>
            <div class="card">
              <h3 class="text-xl font-bold mb-4">Add Medicine</h3>
              <input type="text" placeholder="Search medicine..." class="form-input mb-4" oninput="searchMed(this.value)">
              <div id="results" class="mb-6"></div>
              <div id="prescriptionList" class="space-y-4 mb-6"></div>
              <div class="flex gap-4">
                <button onclick="showToast('Prescription will be saved to database!', 'success')" class="btn btn-success">Save Prescription</button>
                <button onclick="showToast('Preview feature coming soon!', 'info')" class="btn btn-primary">Preview & Print</button>
              </div>
            </div>
          </div>
        `;
      }
      
      return '<div class="card"><p>Content loading...</p></div>';
    }

    function searchMed(q) {
      if (!q || q.length < 2) {
        document.getElementById('results').innerHTML = '';
        return;
      }
      const r = DB.medicines.filter(m => 
        m.name.toLowerCase().includes(q.toLowerCase()) ||
        m.generic_name.toLowerCase().includes(q.toLowerCase()) ||
        m.brand_name.toLowerCase().includes(q.toLowerCase())
      );
      document.getElementById('results').innerHTML = r.map(m => `
        <div class="p-3 border rounded mb-2 cursor-pointer hover:bg-blue-50" onclick="addMed('${m.id}')">
          ${m.name} (${m.brand_name}) - ${m.strength}${m.unit}
        </div>
      `).join('');
    }

    function addMed(id) {
      const m = DB.medicines.find(x => x.id === id);
      currentPrescription.medicines.push(m);
      document.getElementById('prescriptionList').innerHTML = currentPrescription.medicines.map((med, i) => `
        <div class="p-4 bg-gray-50 rounded-xl">
          <p class="font-bold">${i+1}. ${med.name} (${med.brand_name})</p>
          <p class="text-sm text-gray-600">${med.strength}${med.unit} ${med.form}</p>
        </div>
      `).join('');
      document.getElementById('results').innerHTML = '';
      showToast('Medicine added!', 'success');
    }

    render();
  </script>
</body>
</html>